<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aplikasi General Affair Modern</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-firestore-compat.js"></script>

    <style>
        :root {
            --primary: #3b82f6;
            --primary-dark: #2563eb;
            --secondary: #64748b;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --light: #f8fafc;
            --dark: #1e293b;
            --gray: #94a3b8;
            --border: #e2e8f0;
            --card-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --gradient-primary: linear-gradient(135deg, #3b82f6, #6366f1);
            --gradient-success: linear-gradient(135deg, #10b981, #14b8a6);
            --gradient-warning: linear-gradient(135deg, #f59e0b, #f97316);
            --header-height: 80px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: #f1f5f9;
            color: var(--dark);
            line-height: 1.6;
            overflow-x: hidden;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* HEADER */
        header {
            background: var(--gradient-primary);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
            padding: 0;
            position: sticky;
            top: 0;
            z-index: 100;
            height: var(--header-height);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            height: 100%;
            margin: 0 auto;
            max-width: 1200px;
            padding: 0 20px;
        }

        /* Logo Button */
        .logo-button {
            background: none;
            border: none;
            cursor: pointer;
            padding: 0;
            display: flex;
            align-items: center;
            gap: 12px;
            color: white;
            font-weight: 700;
            font-size: 1.5rem;
            transition: all 0.3s ease;
        }
        
        .logo-button:hover {
            transform: translateY(-2px);
        }

        .logo-icon {
            background: rgba(255, 255, 255, 0.2);
            width: 50px;
            height: 50px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }

        .logo-icon:hover {
            transform: rotate(10deg);
            background: rgba(255, 255, 255, 0.25);
        }

        .logo-text {
            display: flex;
            flex-direction: column;
        }

        .logo-main {
            font-size: 1.5rem;
            font-weight: 700;
            line-height: 1.2;
        }

        .logo-sub {
            font-size: 0.8rem;
            opacity: 0.9;
            font-weight: 400;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
            color: white;
            margin-right: 15px;
        }
        
        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
        }
        
        .user-name {
            font-weight: 500;
        }

        /* Notification Bell */
        .notification-container {
            position: relative;
            margin-right: 10px;
        }

        .notification-bell {
            position: relative;
            background: rgba(255, 255, 255, 0.2);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .notification-bell:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.05);
        }

        .notification-count {
            position: absolute;
            top: -5px;
            right: -5px;
            background: var(--primary);
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            font-weight: 600;
            animation: pulse 2s infinite;
        }

        .notification-count.high {
            background: var(--danger);
            animation: pulse 1s infinite;
        }

        .notification-count.medium {
            background: var(--warning);
        }

        .notification-dropdown {
            position: absolute;
            top: 50px;
            right: 0;
            width: 450px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            display: none;
            overflow: hidden;
        }

        .notification-dropdown.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        .notification-header {
            padding: 15px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: var(--gradient-primary);
            color: white;
        }

        .notification-title {
            font-weight: 600;
            font-size: 1.1rem;
        }

        .mark-all-read {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.8rem;
            transition: background 0.3s;
        }

        .mark-all-read:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .notification-list {
            max-height: 500px;
            overflow-y: auto;
        }

        /* Notification Groups */
        .notification-group {
            margin-bottom: 10px;
        }

        .notification-group-title {
            font-size: 0.75rem;
            color: var(--secondary);
            padding: 8px 15px;
            background: #f8fafc;
            border-bottom: 1px solid var(--border);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .notification-item {
            padding: 12px 15px;
            border-bottom: 1px solid var(--border);
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: flex-start;
            gap: 10px;
            position: relative;
        }

        .notification-item:hover {
            background: #f8fafc !important;
        }

        .notification-item.unread {
            background: #f0f9ff;
            border-left: 3px solid var(--primary);
        }

        .notification-item.read {
            opacity: 0.7;
            background: #fafafa;
        }

        .notification-item.read .notification-message {
            color: var(--secondary);
        }

        /* Indicator untuk notifikasi belum dibaca */
        .unread-indicator {
            position: absolute;
            top: 12px;
            right: 12px;
            width: 8px;
            height: 8px;
            background: var(--primary);
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        /* Badge untuk notifikasi baru */
        .new-badge {
            background: var(--danger);
            color: white;
            padding: 2px 6px;
            border-radius: 10px;
            font-size: 0.6rem;
            font-weight: 600;
            margin-right: 5px;
            animation: pulse 1.5s infinite;
        }

        .notification-icon {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            font-size: 0.8rem;
        }

        .notification-icon.pending {
            background: #fef3c7;
            color: #d97706;
        }

        .notification-icon.approved {
            background: #d1fae5;
            color: #059669;
        }

        .notification-icon.rejected {
            background: #fee2e2;
            color: #dc2626;
        }

        .notification-icon.important {
            background: #fef3c7;
            color: #d97706;
            animation: pulse 1.5s infinite;
        }

        .notification-content {
            flex: 1;
        }

        .notification-message {
            font-size: 0.85rem;
            margin-bottom: 3px;
            line-height: 1.4;
        }

        .notification-message strong {
            color: var(--dark);
        }

        .notification-time {
            font-size: 0.75rem;
            color: var(--secondary);
        }

        .notification-empty {
            padding: 30px 20px;
            text-align: center;
            color: var(--secondary);
        }

        .notification-empty i {
            font-size: 3rem;
            margin-bottom: 15px;
            color: var(--gray);
        }

        /* Notification Settings */
        .notification-settings {
            border-top: 1px solid var(--border);
            margin-top: 10px;
            padding: 15px;
            background: #f8fafc;
        }

        .notification-settings .btn {
            width: 100%;
            justify-content: center;
            font-size: 0.75rem;
            padding: 8px 12px;
        }

        .notification-settings .btn:hover {
            transform: none;
            box-shadow: none;
        }

        /* MAIN CONTENT */
        main {
            padding: 3rem 0;
            min-height: calc(100vh - var(--header-height) - 100px);
        }

        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-bottom: 2rem;
        }

        .card {
            background-color: white;
            border-radius: 16px;
            box-shadow: var(--card-shadow);
            padding: 1.8rem;
            cursor: pointer;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(59, 130, 246, 0.1);
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 5px;
            background: var(--gradient-primary);
        }

        .card:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.15), 0 10px 10px -5px rgba(0, 0, 0, 0.08);
        }

        .card-icon {
            width: 70px;
            height: 70px;
            background: var(--gradient-primary);
            border-radius: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 1.2rem;
            color: white;
            font-size: 1.8rem;
            transition: transform 0.3s ease;
            box-shadow: 0 6px 12px rgba(59, 130, 246, 0.25);
        }

        .card:hover .card-icon {
            transform: scale(1.1) rotate(5deg);
        }

        .card-title {
            font-size: 1.3rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--dark);
        }

        .card-desc {
            color: var(--secondary);
            font-size: 0.9rem;
            line-height: 1.5;
        }

        /* FORM SECTION */
        .form-section {
            display: none;
            background-color: white;
            border-radius: 16px;
            box-shadow: var(--card-shadow);
            padding: 2rem;
            margin-bottom: 2rem;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .form-section.active {
            display: block;
        }

        .form-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid var(--border);
        }

        .form-title {
            font-size: 1.8rem;
            font-weight: 600;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .form-tabs {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .form-tab {
            padding: 0.75rem 1.5rem;
            background: #f8fafc;
            border-radius: 0.5rem;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s;
        }

        .form-tab.active {
            background: var(--gradient-primary);
            color: white;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1rem;
        }

        .form-group {
            margin-bottom: 1.2rem;
            position: relative;
        }

        label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: var(--dark);
        }

        input, select, textarea {
            width: 100%;
            padding: 0.85rem;
            border: 1px solid var(--border);
            border-radius: 0.5rem;
            font-size: 1rem;
            transition: border-color 0.3s, box-shadow 0.3s;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.15);
        }

        textarea {
            min-height: 120px;
            resize: vertical;
        }

        .btn {
            padding: 0.85rem 1.8rem;
            border: none;
            border-radius: 0.5rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: var(--gradient-primary);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px -1px rgba(59, 130, 246, 0.3);
        }

        .btn-secondary {
            background-color: var(--secondary);
            color: white;
        }

        .btn-secondary:hover {
            background-color: #475569;
        }

        .confirmation {
            display: none;
            padding: 2rem;
            background: var(--gradient-success);
            border-radius: 1rem;
            margin-top: 1.5rem;
            text-align: center;
            color: white;
            animation: slideIn 0.5s ease;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .confirmation.active {
            display: block;
        }

        .confirmation-icon {
            font-size: 3.5rem;
            margin-bottom: 1rem;
            animation: bounce 1s infinite alternate;
        }

        @keyframes bounce {
            from { transform: translateY(0); }
            to { transform: translateY(-10px); }
        }

        .requests-list {
            margin-top: 2rem;
            border-top: 2px solid var(--border);
            padding-top: 1.5rem;
            display: none;
        }

        .requests-list.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        .requests-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .requests-title {
            font-size: 1.4rem;
            font-weight: 600;
            color: var(--dark);
        }

        .request-item {
            background: #f8fafc;
            border-radius: 0.75rem;
            padding: 1.2rem;
            margin-bottom: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: transform 0.3s;
            animation: slideInItem 0.4s ease;
        }

        @keyframes slideInItem {
            from { opacity: 0; transform: translateX(-20px); }
            to { opacity: 1; transform: translateX(0); }
        }

        .request-item:hover {
            transform: translateX(5px);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        .request-info {
            flex: 1;
        }

        .request-title {
            font-weight: 600;
            margin-bottom: 0.3rem;
            color: var(--dark);
        }

        .request-details {
            color: var(--secondary);
            font-size: 0.9rem;
        }

        .request-status {
            padding: 0.4rem 0.8rem;
            border-radius: 2rem;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .status-pending {
            background-color: #fef3c7;
            color: #d97706;
        }

        .status-approved {
            background-color: #d1fae5;
            color: #059669;
        }

        .status-rejected {
            background-color: #fee2e2;
            color: #dc2626;
        }

        /* Status dropdown yang lebih kecil */
        .status-dropdown {
            padding: 0.3rem 0.6rem;
            border-radius: 0.5rem;
            border: 1px solid var(--border);
            font-size: 0.75rem;
            font-weight: 500;
            cursor: pointer;
            background: white;
            min-width: 100px;
            max-width: 120px;
            margin-left: auto;
        }

        .status-dropdown:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.15);
        }

        .status-dropdown.pending {
            background-color: #fef3c7;
            color: #d97706;
            border-color: #f59e0b;
        }

        .status-dropdown.approved {
            background-color: #d1fae5;
            color: #059669;
            border-color: #10b981;
        }

        .status-dropdown.rejected {
            background-color: #fee2e2;
            color: #dc2626;
            border-color: #ef4444;
        }

        .empty-state {
            text-align: center;
            padding: 2rem;
            color: var(--secondary);
        }

        .empty-state i {
            font-size: 3rem;
            margin-bottom: 1rem;
            color: var(--gray);
        }

        /* Highlight effect for requested items */
        .request-highlight {
            background-color: #e0f2fe !important;
            transition: background-color 0.3s;
            border-left: 4px solid var(--primary);
        }

        /* FOOTER */
        footer {
            background-color: var(--dark);
            color: white;
            padding: 1rem 0;
            text-align: center;
            margin-top: 2rem;
        }

        .footer-content {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .footer-content p {
            margin: 0;
            font-size: 0.9rem;
            color: var(--gray);
            line-height: 1.4;
        }

        @media (max-width: 768px) {
            .dashboard {
                grid-template-columns: 1fr;
            }
            
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .request-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 1rem;
            }
            
            .request-status {
                align-self: flex-start;
            }
            
            .logo-text {
                display: none;
            }
            
            .user-name {
                display: none;
            }

            .notification-dropdown {
                width: 320px;
                right: -50px;
            }

            footer {
                padding: 0.8rem 0;
            }
            
            .footer-content p {
                font-size: 0.8rem;
            }
        }

        /* Animations */
        @keyframes pulse {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.05); opacity: 0.8; }
            100% { transform: scale(1); opacity: 1; }
        }

        .pulse {
            animation: pulse 2s infinite;
        }

        .btn-sm {
            padding: 0.5rem 1rem;
            font-size: 0.85rem;
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-danger:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px -1px rgba(239, 68, 68, 0.3);
        }

        /* Login Page - DIUBAH: Hilangkan logo icon */
        .login-container {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .login-container.active {
            display: flex;
        }

        .login-card {
            background-color: white;
            padding: 2.5rem;
            border-radius: 16px;
            box-shadow: var(--card-shadow);
            text-align: center;
            width: 100%;
            max-width: 400px;
            animation: fadeIn 0.5s ease;
        }

        /* HAPUS logo icon dari tampilan login */
        .login-card .logo {
            justify-content: center;
            margin-bottom: 1.5rem;
            color: var(--primary);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }

        /* HAPUS logo-icon dari login */
        .login-card .logo-icon {
            display: none;
        }

        .login-card .logo-text {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
        }

        .login-card .logo-main {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary);
        }

        .login-card .logo-sub {
            font-size: 0.9rem;
            color: var(--secondary);
            font-weight: 400;
        }

        .login-card h2 {
            font-size: 1.8rem;
            font-weight: 600;
            color: var(--dark);
            margin-bottom: 1.5rem;
        }

        .login-card .form-group {
            margin-bottom: 1rem;
            text-align: left;
        }

        .login-card .btn {
            width: 100%;
            margin-top: 1rem;
        }

        .login-card .btn-secondary {
            background-color: var(--gray);
        }

        .login-card .btn-secondary:hover {
            background-color: #475569;
        }

        .error-message {
            color: var(--danger);
            margin-top: 1rem;
            font-size: 0.9rem;
            display: none;
        }

        /* Hide main content when login page is active */
        body.login-active header,
        body.login-active main,
        body.login-active footer {
            display: none;
        }

        /* Approved-by section */
        .approver-checkboxes {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 15px;
        }

        .approver-option {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        /* Custom Alert */
        .custom-alert {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 8px;
            color: white;
            font-weight: 500;
            z-index: 1001;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            animation: slideInRight 0.3s ease;
        }

        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .alert-success {
            background-color: var(--success);
        }

        .alert-danger {
            background-color: var(--danger);
        }

        .alert-warning {
            background-color: var(--warning);
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* WhatsApp Button */
        .whatsapp-button {
            position: fixed;
            bottom: 25px;
            right: 25px;
            width: 60px;
            height: 60px;
            background-color: #25D366;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 20px rgba(37, 211, 102, 0.4);
            z-index: 999;
            transition: all 0.3s ease;
            cursor: pointer;
            animation: pulse-green 2s infinite;
        }

        .whatsapp-button:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 25px rgba(37, 211, 102, 0.6);
        }

        .whatsapp-button i {
            color: white;
            font-size: 30px;
        }

        @keyframes pulse-green {
            0% { box-shadow: 0 0 0 0 rgba(37, 211, 102, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(37, 211, 102, 0); }
            100% { box-shadow: 0 0 0 0 rgba(37, 211, 102, 0); }
        }

        /* Checkbox group untuk jenis konsumsi */
        .checkbox-group {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 10px;
        }

        .checkbox-option {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            background-color: #f8fafc;
            border-radius: 8px;
            border: 1px solid var(--border);
            transition: all 0.3s;
        }

        .checkbox-option:hover {
            background-color: #f1f5f9;
            border-color: var(--primary);
        }

        .checkbox-option input[type="checkbox"] {
            width: auto;
            margin: 0;
        }

        .checkbox-option label {
            margin: 0;
            font-weight: 500;
            cursor: pointer;
        }

        .checkbox-option.selected {
            background-color: #e0f2fe;
            border-color: var(--primary);
            color: var(--primary);
        }

        /* Autocomplete Styles */
        .autocomplete-dropdown {
            position: absolute;
            background: white;
            border: 1px solid var(--border);
            border-radius: 0.5rem;
            max-height: 200px;
            overflow-y: auto;
            z-index: 1000;
            width: 100%;
            box-shadow: var(--card-shadow);
            margin-top: 2px;
        }

        .autocomplete-dropdown div {
            padding: 10px;
            cursor: pointer;
            border-bottom: 1px solid #f1f5f9;
            transition: background-color 0.2s;
        }

        .autocomplete-dropdown div:hover {
            background-color: #f8fafc;
        }

        .autocomplete-dropdown div:last-child {
            border-bottom: none;
        }

        .autocomplete-active {
            background-color: var(--primary) !important;
            color: white !important;
        }
    </style>
</head>
<body>
    <!-- WhatsApp Button -->
    <a href="https://wa.me/6289601661771" target="_blank" class="whatsapp-button">
        <i class="fab fa-whatsapp"></i>
    </a>

    <!-- Login Page - DIUBAH: Hilangkan logo icon -->
    <div id="login-page" class="login-container active">
        <div class="login-card">
            <div class="logo">
                <div class="logo-text">
                    <span class="logo-main">GA System</span>
                    <span class="logo-sub">General Affair</span>
                </div>
            </div>
            <h2>Login ke Aplikasi</h2>
            <form id="login-form">
                <div class="form-group">
                    <label for="login-email">Email</label>
                    <input type="email" id="login-email" placeholder="Masukkan email Anda" required>
                </div>
                <div class="form-group">
                    <label for="login-password">Password</label>
                    <input type="password" id="login-password" placeholder="Masukkan password Anda" required>
                </div>
                <button type="submit" class="btn btn-primary">Login</button>
                <button type="button" id="guest-login-btn" class="btn btn-secondary">Masuk Sebagai Tamu</button>
                <p class="error-message" id="login-error"></p>
            </form>
        </div>
    </div>

    <header style="display: none;">
        <div class="header-content">
            <!-- Logo Button -->
            <button class="logo-button" id="logo-home-button">
                <div class="logo-icon">
                    <i class="fas fa-building"></i>
                </div>
                <div class="logo-text">
                    <span class="logo-main">GA System</span>
                    <span class="logo-sub">General Affair</span>
                </div>
            </button>
            <div class="header-right">
                <div class="notification-container">
                    <div class="notification-bell" id="notification-bell">
                        <i class="fas fa-bell"></i>
                        <div class="notification-count" id="notification-count" style="display: none;">0</div>
                    </div>
                    <div class="notification-dropdown" id="notification-dropdown">
                        <div class="notification-header">
                            <div class="notification-title">Notifikasi</div>
                            <button class="mark-all-read" id="mark-all-read">Tandai Sudah Dibaca</button>
                        </div>
                        <div class="notification-list" id="notification-list">
                            <div class="notification-empty">
                                <i class="fas fa-bell-slash"></i>
                                <p>Tidak ada notifikasi</p>
                            </div>
                        </div>
                        <div class="notification-settings" id="notification-settings" style="display: none;">
                            <div style="font-size: 0.8rem; color: var(--secondary); margin-bottom: 5px;">Pengaturan Notifikasi</div>
                            <button id="enable-notifications" class="btn btn-sm" style="background: var(--primary); color: white; padding: 5px 10px; font-size: 0.7rem;">
                                <i class="fas fa-bell"></i> Aktifkan Notifikasi Browser
                            </button>
                            <div id="notification-status" style="font-size: 0.7rem; margin-top: 5px;"></div>
                        </div>
                    </div>
                </div>
                <div id="user-info" class="user-info" style="display: none;">
                    <div class="user-avatar" id="user-avatar">U</div>
                    <span class="user-name" id="user-name"></span>
                </div>
                <button id="logout-btn" class="btn btn-secondary" style="display: none;"><i class="fas fa-sign-out-alt"></i> Logout</button>
            </div>
        </div>
    </header>

    <main class="container" style="display: none;">
        <!-- Dashboard Section -->
        <section id="dashboard" class="dashboard">
            <div class="card" data-target="form-atk">
                <div class="card-icon"><i class="fas fa-pencil-alt"></i></div>
                <h3 class="card-title">Form Request GA</h3>
                <p class="card-desc">Ajukan permintaan barang dan jasa untuk kebutuhan pekerjaan</p>
            </div>
            
            <div class="card" data-target="form-idcard">
                <div class="card-icon"><i class="fas fa-address-card"></i></div>
                <h3 class="card-title">Form Request ID Card</h3>
                <p class="card-desc">Ajukan pembuatan atau penggantian kartu identitas karyawan</p>
            </div>
            
            <div class="card" data-target="form-konsumsi">
                <div class="card-icon"><i class="fas fa-utensils"></i></div>
                <h3 class="card-title">Form Request Konsumsi</h3>
                <p class="card-desc">Ajukan kebutuhan konsumsi untuk meeting atau acara perusahaan</p>
            </div>
            
            <div class="card" data-target="form-laptop">
                <div class="card-icon"><i class="fas fa-laptop"></i></div>
                <h3 class="card-title">Form Request IT</h3>
                <p class="card-desc">Ajukan permintaan atau perbaikan perangkat</p>
            </div>
            
            <!-- Kartu Nama Card - Posisi Baru -->
            <div class="card" data-target="form-kartunama">
                <div class="card-icon"><i class="fas fa-id-card"></i></div>
                <h3 class="card-title">Form Request Kartu Nama</h3>
                <p class="card-desc">Ajukan pembuatan kartu nama untuk keperluan profesional</p>
            </div>
            
            <div class="card" data-target="form-feedback">
                <div class="card-icon"><i class="fas fa-comment-alt"></i></div>
                <h3 class="card-title">Feedback untuk GA</h3>
                <p class="card-desc">Berikan masukan dan saran untuk perbaikan layanan General Affair</p>
            </div>
        </section>

        <!-- Form Request ATK -->
        <section id="form-atk" class="form-section">
            <div class="form-header">
                <h2 class="form-title"><i class="fas fa-pencil-alt"></i> Form Request GA</h2>
            </div>
            
            <div class="form-tabs">
                <div class="form-tab active" data-tab="form">Form Request</div>
                <div class="form-tab" data-tab="requests" id="atk-requests-tab">Daftar Request</div>
                <div class="form-tab" data-tab="approved-by" id="atk-approved-tab">Approved By</div>
            </div>
            
            <div class="form-content">
                <form id="atkForm">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="atk-nama">Nama Pemohon</label>
                            <input type="text" id="atk-nama" name="nama" required>
                        </div>
                        <div class="form-group">
                            <label for="atk-department">Department</label>
                            <input type="text" id="atk-department" name="department" required readonly>
                        </div>
                        <div class="form-group">
                            <label for="atk-tanggal">Tanggal Permintaan</label>
                            <input type="date" id="atk-tanggal" name="tanggal" required>
                        </div>
                        <div class="form-group">
                            <label for="atk-jenis">Kategori Permintaan</label>
                            <select id="atk-jenis" name="jenis" required>
                                <option value="">Pilih Kategori</option>
                                <option value="Jasa">Jasa</option>
                                <option value="Barang">Barang</option>
                            </select>
                        </div>
                        <!-- Form Baru untuk Request GA -->
                        <div class="form-group">
                            <label for="atk-nilai">Nilai Permintaan</label>
                            <select id="atk-nilai" name="nilai" required>
                                <option value="">Pilih Nilai</option>
                                <option value="Atas 1jt">Atas 1jt</option>
                                <option value="Bawah 1jt">Bawah 1jt</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="atk-detail">Detail Permintaan</label>
                        <textarea id="atk-detail" name="detail" placeholder="Jelaskan detail yang diperlukan, termasuk jumlah dan spesifikasi" required></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="atk-alasan">Alasan Kebutuhan</label>
                        <textarea id="atk-alasan" name="alasan" placeholder="Jelaskan alasan dan urgensi kebutuhan ini" required></textarea>
                    </div>
                    
                    <button type="submit" class="btn btn-primary"><i class="fas fa-paper-plane"></i> Ajukan Permintaan</button>
                    <button type="button" class="btn btn-secondary back-button"><i class="fas fa-arrow-left"></i> Kembali ke Beranda</button>
                </form>
                
                <div id="atk-confirmation" class="confirmation">
                    <div class="confirmation-icon"><i class="fas fa-check-circle"></i></div>
                    <h3>Permintaan GA Berhasil Diajukan!</h3>
                    <p>Terima kasih telah mengajukan permintaan GA. Tim General Affair akan segera memproses permintaan Anda.</p>
                </div>
                
                <div id="atk-requests" class="requests-list">
                    <div class="requests-header">
                        <h3 class="requests-title">Daftar Request GA</h3>
                        <button class="btn btn-primary" id="refresh-atk"><i class="fas fa-sync-alt"></i> Refresh</button>
                    </div>
                    
                    <div id="atk-requests-list">
                        <div class="empty-state">
                            <i class="fas fa-inbox"></i>
                            <p>Memuat data request...</p>
                        </div>
                    </div>
                </div>

                <div id="atk-approved-by" class="requests-list">
                    <div class="requests-header">
                        <h3 class="requests-title">Persetujuan Request GA</h3>
                        <button class="btn btn-primary" id="refresh-atk-approved"><i class="fas fa-sync-alt"></i> Refresh</button>
                    </div>
                    <div id="atk-approved-by-list">
                        <div class="empty-state">
                            <i class="fas fa-check-double"></i>
                            <p>Memuat data request...</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Form Request ID Card -->
        <section id="form-idcard" class="form-section">
            <div class="form-header">
                <h2 class="form-title"><i class="fas fa-address-card"></i> Form Request ID Card</h2>
            </div>
            
            <div class="form-tabs">
                <div class="form-tab active" data-tab="form">Form Request</div>
                <div class="form-tab" data-tab="requests" id="idcard-requests-tab">Daftar Request</div>
            </div>
            
            <div class="form-content">
                <form id="idcardForm">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="idcard-nama">Nama Lengkap</label>
                            <input type="text" id="idcard-nama" name="nama" required>
                        </div>
                        <div class="form-group">
                            <label for="idcard-department">Department</label>
                            <input type="text" id="idcard-department" name="department" required readonly>
                        </div>
                        <div class="form-group">
                            <label for="idcard-posisi">Posisi</label>
                            <input type="text" id="idcard-posisi" name="posisi" required>
                        </div>
                        <div class="form-group">
                            <label for="idcard-jenis-request">Jenis Request</label>
                            <select id="idcard-jenis-request" name="jenis-request" required>
                                <option value="">Pilih Jenis Request</option>
                                <option value="Baru">Baru</option>
                                <option value="Penggantian (Hilang/Rusak)">Penggantian (Hilang/Rusak)</option>
                                <option value="Perubahan Data">Perubahan Data</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="idcard-keterangan">Keterangan Tambahan</label>
                        <textarea id="idcard-keterangan" name="keterangan" placeholder="Jelaskan alasan penggantian atau perubahan data jika ada"></textarea>
                    </div>
                    
                    <button type="submit" class="btn btn-primary"><i class="fas fa-paper-plane"></i> Ajukan Permintaan</button>
                    <button type="button" class="btn btn-secondary back-button"><i class="fas fa-arrow-left"></i> Kembali ke Beranda</button>
                </form>
                
                <div id="idcard-confirmation" class="confirmation">
                    <div class="confirmation-icon"><i class="fas fa-check-circle"></i></div>
                    <h3>Permintaan ID Card Berhasil Diajukan!</h3>
                    <p>Terima kasih telah mengajukan permintaan ID Card. Tim General Affair akan segera memproses permintaan Anda.</p>
                </div>
                
                <div id="idcard-requests" class="requests-list">
                    <div class="requests-header">
                        <h3 class="requests-title">Daftar Request ID Card</h3>
                        <button class="btn btn-primary" id="refresh-idcard"><i class="fas fa-sync-alt"></i> Refresh</button>
                    </div>
                    
                    <div id="idcard-requests-list">
                        <div class="empty-state">
                            <i class="fas fa-inbox"></i>
                            <p>Memuat data request...</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Form Request Konsumsi - MODIFIED FOR MULTIPLE SELECTION -->
        <section id="form-konsumsi" class="form-section">
            <div class="form-header">
                <h2 class="form-title"><i class="fas fa-utensils"></i> Form Request Konsumsi</h2>
            </div>
            
            <div class="form-tabs">
                <div class="form-tab active" data-tab="form">Form Request</div>
                <div class="form-tab" data-tab="requests" id="konsumsi-requests-tab">Daftar Request</div>
            </div>
            
            <div class="form-content">
                <form id="konsumsiForm">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="konsumsi-nama">Nama Pemohon</label>
                            <input type="text" id="konsumsi-nama" name="nama" required>
                        </div>
                        <div class="form-group">
                            <label for="konsumsi-department">Department</label>
                            <input type="text" id="konsumsi-department" name="department" required readonly>
                        </div>
                        <div class="form-group">
                            <label for="konsumsi-tanggal">Tanggal Acara</label>
                            <input type="date" id="konsumsi-tanggal" name="tanggal" required>
                        </div>
                        <div class="form-group">
                            <label for="konsumsi-waktu">Waktu Acara</label>
                            <input type="time" id="konsumsi-waktu" name="waktu" required>
                        </div>
                        <div class="form-group">
                            <label for="konsumsi-acara">Nama Acara/Kegiatan</label>
                            <input type="text" id="konsumsi-acara" name="acara" required>
                        </div>
                        <div class="form-group">
                            <label for="konsumsi-jumlah-peserta">Jumlah Peserta</label>
                            <input type="number" id="konsumsi-jumlah-peserta" name="jumlah-peserta" min="1" required>
                        </div>
                        <!-- MODIFIED: Changed from select to checkbox group -->
                        <div class="form-group">
                            <label>Jenis Konsumsi</label>
                            <div class="checkbox-group">
                                <div class="checkbox-option">
                                    <input type="checkbox" id="konsumsi-snack" name="jenis-konsumsi" value="Snack Box">
                                    <label for="konsumsi-snack">Snack Box</label>
                                </div>
                                <div class="checkbox-option">
                                    <input type="checkbox" id="konsumsi-makan-siang" name="jenis-konsumsi" value="Makan Siang">
                                    <label for="konsumsi-makan-siang">Makan Siang</label>
                                </div>
                                <div class="checkbox-option">
                                    <input type="checkbox" id="konsumsi-makan-malam" name="jenis-konsumsi" value="Makan Malam">
                                    <label for="konsumsi-makan-malam">Makan Malam</label>
                                </div>
                                <div class="checkbox-option">
                                    <input type="checkbox" id="konsumsi-kopi-teh" name="jenis-konsumsi" value="Kopi/Teh">
                                    <label for="konsumsi-kopi-teh">Kopi/Teh</label>
                                </div>
                                <div class="checkbox-option">
                                    <input type="checkbox" id="konsumsi-lainnya" name="jenis-konsumsi" value="Lainnya">
                                    <label for="konsumsi-lainnya">Lainnya</label>
                                </div>
                            </div>
                        </div>
                        <div class="form-group" id="konsumsi-lainnya-detail" style="display: none;">
                            <label for="konsumsi-lainnya-detail-input">Detail Konsumsi Lainnya</label>
                            <input type="text" id="konsumsi-lainnya-detail-input" name="konsumsi-lainnya-detail" placeholder="Jelaskan jenis konsumsi lainnya">
                        </div>
                        <div class="form-group">
                            <label for="konsumsi-budget">Estimasi Budget per Orang (Opsional)</label>
                            <input type="number" id="konsumsi-budget" name="budget" min="0">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="konsumsi-detail">Detail Konsumsi & Keterangan</label>
                        <textarea id="konsumsi-detail" name="detail" placeholder="Jelaskan detail menu, preferensi, atau alergi jika ada"></textarea>
                    </div>
                    
                    <button type="submit" class="btn btn-primary"><i class="fas fa-paper-plane"></i> Ajukan Permintaan</button>
                    <button type="button" class="btn btn-secondary back-button"><i class="fas fa-arrow-left"></i> Kembali ke Beranda</button>
                </form>
                
                <div id="konsumsi-confirmation" class="confirmation">
                    <div class="confirmation-icon"><i class="fas fa-check-circle"></i></div>
                    <h3>Permintaan Konsumsi Berhasil Diajukan!</h3>
                    <p>Tim General Affair akan segera menyiapkan konsumsi untuk acara Anda.</p>
                </div>
                
                <div id="konsumsi-requests" class="requests-list">
                    <div class="requests-header">
                        <h3 class="requests-title">Daftar Request Konsumsi</h3>
                        <button class="btn btn-primary" id="refresh-konsumsi"><i class="fas fa-sync-alt"></i> Refresh</button>
                    </div>
                    
                    <div id="konsumsi-requests-list">
                        <div class="empty-state">
                            <i class="fas fa-inbox"></i>
                            <p>Memuat data request...</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Form Request Laptop -->
        <section id="form-laptop" class="form-section">
            <div class="form-header">
                <h2 class="form-title"><i class="fas fa-laptop"></i> Form Request IT</h2>
            </div>
            
            <div class="form-tabs">
                <div class="form-tab active" data-tab="form">Form Request</div>
                <div class="form-tab" data-tab="requests" id="laptop-requests-tab">Daftar Request</div>
                <div class="form-tab" data-tab="approved-by" id="laptop-approved-tab">Approved By</div>
            </div>
            
            <div class="form-content">
                <form id="laptopForm">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="laptop-nama">Nama Pemohon</label>
                            <input type="text" id="laptop-nama" name="nama" required>
                        </div>
                        <div class="form-group">
                            <label for="laptop-department">Department</label>
                            <input type="text" id="laptop-department" name="department" required readonly>
                        </div>
                        <div class="form-group">
                            <label for="laptop-tanggal">Tanggal Permintaan</label>
                            <input type="date" id="laptop-tanggal" name="tanggal" required>
                        </div>
                        <div class="form-group">
                            <label for="laptop-jenis-request">Jenis Request</label>
                            <select id="laptop-jenis-request" name="jenis-request" required>
                                <option value="">Pilih Jenis Request</option>
                                <option value="Pengadaan Baru">Pengadaan Baru</option>
                                <option value="Perbaikan">Perbaikan</option>
                                <option value="Upgrade">Upgrade</option>
                                <option value="Penggantian">Penggantian</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="laptop-spesifikasi">Spesifikasi Diinginkan (untuk pengadaan/upgrade)</label>
                            <input type="text" id="laptop-spesifikasi" name="spesifikasi" placeholder="Contoh: Core i7, RAM 16GB, SSD 512GB">
                        </div>
                        <div class="form-group">
                            <label for="laptop-merk-model">Merk/Model (untuk perbaikan/penggantian)</label>
                            <input type="text" id="laptop-merk-model" name="merk-model" placeholder="Contoh: Dell Latitude 7420">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="laptop-masalah-kebutuhan">Deskripsi Masalah / Kebutuhan</label>
                        <textarea id="laptop-masalah-kebutuhan" name="masalah-kebutuhan" placeholder="Jelaskan masalah yang terjadi atau kebutuhan spesifik Anda" required></textarea>
                    </div>
                    
                    <button type="submit" class="btn btn-primary"><i class="fas fa-paper-plane"></i> Ajukan Permintaan</button>
                    <button type="button" class="btn btn-secondary back-button"><i class="fas fa-arrow-left"></i> Kembali ke Beranda</button>
                </form>
                
                <div id="laptop-confirmation" class="confirmation">
                    <div class="confirmation-icon"><i class="fas fa-check-circle"></i></div>
                    <h3>Permintaan Barang Berhasil Diajukan!</h3>
                    <p>Tim General Affair akan segera menindaklanjuti permintaan barang Anda.</p>
                </div>
                
                <div id="laptop-requests" class="requests-list">
                    <div class="requests-header">
                        <h3 class="requests-title">Daftar Request IT</h3>
                        <button class="btn btn-primary" id="refresh-laptop"><i class="fas fa-sync-alt"></i> Refresh</button>
                    </div>
                    
                    <div id="laptop-requests-list">
                        <div class="empty-state">
                            <i class="fas fa-inbox"></i>
                            <p>Memuat data request...</p>
                        </div>
                    </div>
                </div>

                <div id="laptop-approved-by" class="requests-list">
                    <div class="requests-header">
                        <h3 class="requests-title">Persetujuan Request IT</h3>
                        <button class="btn btn-primary" id="refresh-laptop-approved"><i class="fas fa-sync-alt"></i> Refresh</button>
                    </div>
                    <div id="laptop-approved-by-list">
                        <div class="empty-state">
                            <i class="fas fa-check-double"></i>
                            <p>Memuat data request...</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Form Request Kartu Nama - Form Baru -->
        <section id="form-kartunama" class="form-section">
            <div class="form-header">
                <h2 class="form-title"><i class="fas fa-id-card"></i> Form Request Kartu Nama</h2>
            </div>
            
            <div class="form-tabs">
                <div class="form-tab active" data-tab="form">Form Request</div>
                <div class="form-tab" data-tab="requests" id="kartunama-requests-tab">Daftar Request</div>
            </div>
            
            <div class="form-content">
                <form id="kartunamaForm">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="kartunama-nama">Nama Lengkap</label>
                            <input type="text" id="kartunama-nama" name="nama" required>
                        </div>
                        <div class="form-group">
                            <label for="kartunama-department">Department</label>
                            <input type="text" id="kartunama-department" name="department" required readonly>
                        </div>
                        <div class="form-group">
                            <label for="kartunama-posisi">Posisi</label>
                            <input type="text" id="kartunama-posisi" name="posisi" required>
                        </div>
                        <div class="form-group">
                            <label for="kartunama-email">Email Kantor</label>
                            <input type="email" id="kartunama-email" name="email" required>
                        </div>
                        <div class="form-group">
                            <label for="kartunama-telpon">Nomor Telepon</label>
                            <input type="tel" id="kartunama-telpon" name="telpon" required>
                        </div>
                        <div class="form-group">
                            <label for="kartunama-jumlah">Jumlah Kartu Nama</label>
                            <input type="number" id="kartunama-jumlah" name="jumlah" min="1" required>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="kartunama-keterangan">Keterangan Tambahan</label>
                        <textarea id="kartunama-keterangan" name="keterangan" placeholder="Tambahkan keterangan atau catatan khusus untuk kartu nama"></textarea>
                    </div>
                    
                    <button type="submit" class="btn btn-primary"><i class="fas fa-paper-plane"></i> Ajukan Permintaan</button>
                    <button type="button" class="btn btn-secondary back-button"><i class="fas fa-arrow-left"></i> Kembali ke Beranda</button>
                </form>
                
                <div id="kartunama-confirmation" class="confirmation">
                    <div class="confirmation-icon"><i class="fas fa-check-circle"></i></div>
                    <h3>Permintaan Kartu Nama Berhasil Diajukan!</h3>
                    <p>Terima kasih telah mengajukan permintaan kartu nama. Tim General Affair akan segera memproses permintaan Anda.</p>
                </div>
                
                <div id="kartunama-requests" class="requests-list">
                    <div class="requests-header">
                        <h3 class="requests-title">Daftar Request Kartu Nama</h3>
                        <button class="btn btn-primary" id="refresh-kartunama"><i class="fas fa-sync-alt"></i> Refresh</button>
                    </div>
                    
                    <div id="kartunama-requests-list">
                        <div class="empty-state">
                            <i class="fas fa-inbox"></i>
                            <p>Memuat data request...</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Form Feedback untuk GA -->
        <section id="form-feedback" class="form-section">
            <div class="form-header">
                <h2 class="form-title"><i class="fas fa-comment-alt"></i> Feedback untuk General Affair</h2>
            </div>
            
            <div class="form-tabs">
                <div class="form-tab active" data-tab="form">Form Feedback</div>
                <div class="form-tab" data-tab="requests" id="feedback-requests-tab">Daftar Feedback</div>
            </div>
            
            <div class="form-content">
                <form id="feedbackForm">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="feedback-nama">Nama</label>
                            <input type="text" id="feedback-nama" name="nama" required>
                        </div>
                        <div class="form-group">
                            <label for="feedback-department">Department</label>
                            <input type="text" id="feedback-department" name="department" required readonly>
                        </div>
                        <div class="form-group">
                            <label for="feedback-tanggal">Tanggal</label>
                            <input type="date" id="feedback-tanggal" name="tanggal" required>
                        </div>
                        <div class="form-group">
                            <label for="feedback-kategori">Kategori Feedback</label>
                            <select id="feedback-kategori" name="kategori" required>
                                <option value="">Pilih Kategori</option>
                                <option value="Layanan">Layanan</option>
                                <option value="Fasilitas">Fasilitas</option>
                                <option value="Proses">Proses</option>
                                <option value="Lainnya">Lainnya</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="feedback-masukan">Masukan dan Saran</label>
                        <textarea id="feedback-masukan" name="masukan" placeholder="Berikan masukan dan saran untuk perbaikan layanan General Affair" required></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="feedback-penilaian">Penilaian Layanan (1-10)</label>
                        <input type="number" id="feedback-penilaian" name="penilaian" min="1" max="10" required>
                    </div>
                    
                    <button type="submit" class="btn btn-primary"><i class="fas fa-paper-plane"></i> Kirim Feedback</button>
                    <button type="button" class="btn btn-secondary back-button"><i class="fas fa-arrow-left"></i> Kembali ke Beranda</button>
                </form>
                
                <div id="feedback-confirmation" class="confirmation">
                    <div class="confirmation-icon"><i class="fas fa-check-circle"></i></div>
                    <h3>Feedback Berhasil Dikirim!</h3>
                    <p>Terima kasih atas masukan Anda. Tim General Affair akan menindaklanjuti feedback ini.</p>
                </div>
                
                <div id="feedback-requests" class="requests-list">
                    <div class="requests-header">
                        <h3 class="requests-title">Daftar Feedback</h3>
                        <button class="btn btn-primary" id="refresh-feedback"><i class="fas fa-sync-alt"></i> Refresh</button>
                    </div>
                    
                    <div id="feedback-requests-list">
                        <div class="empty-state">
                            <i class="fas fa-inbox"></i>
                            <p>Memuat data feedback...</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

    </main>

    <!-- FOOTER -->
    <footer style="display: none;">
        <div class="container footer-content">
            <p>&copy; 2025 General Affair System - Aplikasi Manajemen Kebutuhan Perusahaan</p>
        </div>
    </footer>

    <!-- Autocomplete Data -->
    <script>
        // autocomplete-data.js
        // Data untuk autocomplete nama dan departemen

        // Daftar atasan langsung yang dapat menyetujui request GA
        const atasanLangsung = [
            "Anggita Septiani",
            "Edwin Qomarudin", 
            "Heksi Prasetyo",
            "Wahyu YIB",
            "Caecilia Renata",
            "Rossiana Y.L",
            "Muhamad Husni",
            "David Tides Sagita",
            "Fiki Hernawan"
        ];

        // Mapping karyawan ke atasan langsung
        const employeeToAtasanMap = {
            // Contoh mapping karyawan ke atasan langsung
        "Ajar Sono": "Edwin Qomarudin",
        "Beni Permana": "Edwin Qomarudin", 
        "Dede Haryanto": "Edwin Qomarudin", 
        "Erik Eriyanto": "Edwin Qomarudin", 
        "Kamil Alfalaq": "Edwin Qomarudin", 
        "Endang Supriyatna": "Edwin Qomarudin", 
        "Syaiful Anwar": "Edwin Qomarudin", 
        "Anis Marzuki": "Edwin Qomarudin", 
        "Achmadi": "Edwin Qomarudin", 
        "Ari Sabila Rahman": "Edwin Qomarudin", 
        "Daniel Saputra": "Edwin Qomarudin", 
        "Iman Supratman": "Edwin Qomarudin", 
        "M Irchamu Rozaq": "Edwin Qomarudin", 
        "Niko Dermawan": "Edwin Qomarudin", 
        "Novi Irawan": "Edwin Qomarudin", 
        "Saiful Utomo": "Edwin Qomarudin", 
        "Ardan Dwiki Ramadhan": "Edwin Qomarudin", 
        "Adli Syaifulloh": "Edwin Qomarudin", 
        "Dewi Izzatun Nisa": "Edwin Qomarudin", 
        "Edi Susilo": "Edwin Qomarudin", 
        "Gilang Febrianto": "Edwin Qomarudin", 
        "Rizky Nur Andrea Pratama Putra": "Edwin Qomarudin", 
        "Redo Saputro": "Edwin Qomarudin", 
        "A. Khadijah Mauliana SM": "Edwin Qomarudin", 
        "Muhammad Rizal": "Edwin Qomarudin", 
        "Bobby Ardi": "Edwin Qomarudin", 
        "Rahul Suli Mujiburrahman": "Edwin Qomarudin", 
        "Muhammad Mauliana": "Edwin Qomarudin", 
        "Abdul Wahab": "Edwin Qomarudin", 
        "Muhammad Rion Pratama": "Edwin Qomarudin", 
        "Muhamad Fahmi Zulfikar": "Edwin Qomarudin", 
        "Indera Septo Wahyudi": "Edwin Qomarudin", 
        "Ayyub Fathoni": "Edwin Qomarudin", 
        "Muhamad Rio Ferdiansyah": "Fiki Hernawan", 
        "Andriyansyah": "Fiki Hernawan", 
        "Muhammad Farhan Zidan": "Fiki Hernawan", 
        "Prasetyo Bagaskoro": "Fiki Hernawan", 
        "Bayu Pambudi": "Fiki Hernawan", 
        "Elvin Herdiansyah": "Fiki Hernawan", 
        "Indra Adji Syafalaq": "Fiki Hernawan", 
        "Junaidi": "Fiki Hernawan", 
        "Mochamad Rijal Mushthafa": "Fiki Hernawan", 
        "Muhamad": "Fiki Hernawan", 
        "Wahyu Maulana": "Fiki Hernawan", 
        "Dwireza Wirananda": "Fiki Hernawan", 
        "Wisnu Adi Baskoro": "Fiki Hernawan", 
        "Alfiansyah Dira Saputra": "Fiki Hernawan", 
        "Ahmad Zaini": "Fiki Hernawan", 
        "Sayyid Hidayattulloh": "Fiki Hernawan", 
        "Muhammad Billal Dhelian Putra": "Fiki Hernawan", 
        "Agung Santoso": "Fiki Hernawan", 
        "Edy Amin": "Fiki Hernawan", 
        "Proboadi Haryo Wicaksono": "Fiki Hernawan", 
        "Yudiyono": "Fiki Hernawan", 
        "Indra Kurniawan": "Fiki Hernawan", 
        "Mochammad Gorwantoro Putra": "Fiki Hernawan", 
        "Wahyu Sujoko": "Fiki Hernawan", 
        "Luki Dwi Saputra": "Fiki Hernawan", 
        "Muhammad Fahmi Haikal": "Fiki Hernawan", 
        "Ramadhan Nasution": "Fiki Hernawan", 
        "Muhammad Ripaldi Saputra": "Fiki Hernawan", 
        "Anggiat Rorizki Galingging": "Fiki Hernawan", 
        "Abu Faqih Alkafi": "Fiki Hernawan", 
        "Muhamad Raihan Nurudin": "Fiki Hernawan", 
        "Agung Ramadhan": "Fiki Hernawan", 
        "Obay": "Fiki Hernawan", 
        "Imam Royani": "Fiki Hernawan", 
        "Dendi Septiawan": "Fiki Hernawan", 
        "Ajat Sudrajat": "Fiki Hernawan", 
        "Akbar Sobari": "Fiki Hernawan", 
        "Nurti Handoyo": "Fiki Hernawan", 
        "Ramdani Hidayat": "Fiki Hernawan", 
        "Saefulloh": "Fiki Hernawan", 
        "Saripudin": "Fiki Hernawan", 
        "Taufik Krismanto": "Fiki Hernawan", 
        "Ahmad Fuadi": "Fiki Hernawan", 
        "Usman": "Fiki Hernawan", 
        "Tashafani Nurfajrina": "Fiki Hernawan", 
        "Rizky Pratama": "Fiki Hernawan", 
        "Gangsar Setya Utama": "Fiki Hernawan", 
        "Antik Wara Anandiah": "Fiki Hernawan", 
        "Raka Martyohady": "Fiki Hernawan", 
        "Jimmy Alfian Syahputra": "Fiki Hernawan", 
        "Saepul Bahri": "Fiki Hernawan", 
        "Riski Ibrahim": "Fiki Hernawan", 
        "Muhamad Nurfaizi": "Fiki Hernawan", 
        "Ibnu Pangestu": "Fiki Hernawan", 
        "Fiki Septiawan": "Fiki Hernawan", 
        "Khoirul Anam": "Fiki Hernawan", 
        "Rudi Hartono": "Fiki Hernawan", 
        "Asep Saepulloh": "Fiki Hernawan", 
        "Ilman": "Fiki Hernawan", 
        "Suhendar": "Fiki Hernawan", 
        "Yusron Ali Nasution": "Fiki Hernawan", 
        "Tri Teguh Rahmanto": "Fiki Hernawan", 
        "Aries A Bastian": "Fiki Hernawan", 
        "DIMAS": "Fiki Hernawan", 
        "Robiyanto": "Fiki Hernawan", 
        "Taufiq Ocktafianto": "Fiki Hernawan", 
        "Regandi": "Fiki Hernawan", 
        "Adha Ripanggi": "Fiki Hernawan", 
        "M Jakaria": "Fiki Hernawan", 
        "Supriyan": "Fiki Hernawan", 
        "Ismail Septiadi": "Fiki Hernawan", 
        "Muhammad Imam Sueb": "Fiki Hernawan", 
        "Muhamad Razka  Ariq Fadillah": "Fiki Hernawan", 
        "Bintang Timur Ramadhan": "Fiki Hernawan", 
        "Rifqi Zaky Ramadhani": "Fiki Hernawan", 
        "Fauzy Maulana Saputra": "Fiki Hernawan", 
        "Andreansyah Wibowo": "Fiki Hernawan", 
        "Muhammad Alfarizi Abigail": "Fiki Hernawan", 
        "Arif Rahman": "Fiki Hernawan", 
        "Muhammad Ikhsan": "Fiki Hernawan", 
        "I Gede Diartika Mahayasa": "Fiki Hernawan", 
        "Mukhsinun": "Fiki Hernawan", 
        "Yogi Widodo": "Fiki Hernawan", 
        "I Wayan Windhu Winarta": "Fiki Hernawan", 
        "Bagas Kurniawan": "Fiki Hernawan", 
        "Alvin Khoirur Rokhim": "Fiki Hernawan", 
        "Muhamad Rivaldi Putra Pamungkas": "Fiki Hernawan", 
        "Burhadi": "Fiki Hernawan", 
        "Ruli Adiyono": "Fiki Hernawan", 
        "Sohibul Mubarok": "Fiki Hernawan", 
        "mohamad husnal falah": "Fiki Hernawan", 
        "Muhamad Fauji": "Fiki Hernawan", 
        "Dwi Maya Alfiany": "Fiki Hernawan", 
        "Chyndi Ananda Putri": "Fiki Hernawan", 
        "Izbullah Nasution": "Fiki Hernawan", 
        "Sahrul Hidayat": "Fiki Hernawan", 
        "Agrian Rahmat Ayubi": "Fiki Hernawan", 
        "Salman Alfaritsi Bakhtiar": "Fiki Hernawan", 
        "Joko Sarwono": "Heksi Prasetyo", 
        "Andi Suroso": "Heksi Prasetyo", 
        "Triot Susanto": "Heksi Prasetyo", 
        "Sensen Imran Abdillah": "Heksi Prasetyo", 
        "Hery Syah Putra": "Heksi Prasetyo", 
        "Anisa Nur Avivah": "Muhamad Husni", 
        "Fiki Hernawan": "Muhamad Husni", 
        "Heksi Prasetyo": "Muhamad Husni", 
        "Mareta Sri Setiati": "Muhamad Husni", 
        "Edwin Qomarudin": "Muhamad Husni", 
        "Mohammad Ardiyanto": "Wahyu YIB", 
        "Dhona Purnomo": "Wahyu YIB", 
        "Dwi Kartika Ningsih Z": "Wahyu YIB", 
        "Arifa Nurhayati": "Wahyu YIB", 
        "Kurniawan Febrianto": "Wahyu YIB", 
        "Anggita Septiani": "Caecilia Renata", 
        "Brahmantyo Hadiprasetyo": "Caecilia Renata", 
        "Muhamad Husni": "Caecilia Renata", 
        "Caecilia Renata Harsobisono": "Caecilia Renata", 
        "Rossiana Yunita Lampung": "Caecilia Renata", 
        "Reni Nurhayati": "Anggita Septiani", 
        "Salsabila Anisah Putri Farihah": "Anggita Septiani", 
        "Nurmala Dewi": "Anggita Septiani", 
        "Danny": "Anggita Septiani", 
        "Maria Angelina": "Anggita Septiani", 
        "Lie Sani": "Anggita Septiani", 
        "Athania Mahardiyanti": "Anggita Septiani", 
        "Sely Megawati Wahyudi": "Anggita Septiani", 
        "Iskandar Bagus Wahyu Yuwono": "Caecilia Renata", 
        "David Tides Sagita": "Caecilia Renata", 
        "Ulandari": "Caecilia Renata", 
        "Putri Safira": "Caecilia Renata", 
        "Winda Arwanti": "Caecilia Renata", 
        "Galih Satrio": "Caecilia Renata", 
        "Siti Astuti": "Caecilia Renata", 
        "Nurhidayat": "David Tides Sagita", 
        "Ahmad Asyrory": "David Tides Sagita", 
        "Andy Rahman": "David Tides Sagita", 
        "Dhea Stephanie Gazali": "David Tides Sagita", 
        "Pamungkas Tri Sulistiyono": "David Tides Sagita", 
        "Rangga Riseto": "David Tides Sagita", 
        "Bintang Norys Pambudy": "David Tides Sagita", 
        "Arjulu Fadila Nurrahman": "Fiki Hernawan", 
        "Muhamad Afriyansah": "Fiki Hernawan", 
        "Ahmad Rohendi": "Fiki Hernawan", 
        "Wildan Rizki Ramadhan": "Fiki Hernawan", 
        "Ika Rahma Diastiara": "Edwin Qomarudin", 
        "Qosim Cahyo Ihsan Nurdin": "Edwin Qomarudin", 
        "Indi Nurul Hidayah": "Edwin Qomarudin", 
        "Moh. Syafrudin": "Edwin Qomarudin", 
        "Rokhmat Mulyoko": "Edwin Qomarudin", 
        "Lies Setyowati": "Edwin Qomarudin", 
        "Harianto": "Edwin Qomarudin", 
        "Achmad Fadhilah": "Anggita Septiani", 
        "Wahyu Ardiansyah": "Anggita Septiani", 
        "Sarju": "Rossiana Y.L", 
        "Anggina Herbimaya": "Rossiana Y.L", 
        "Evi Komalasari": "Rossiana Y.L", 
        "Maida Faza Kusnadi": "Rossiana Y.L", 
        "Apriadi": "Rossiana Y.L", 
        "Mawarto N": "Rossiana Y.L", 
        "Abdul Kafi": "Rossiana Y.L", 
        "Abdul Rahman": "Rossiana Y.L", 
        "Mashadi": "Rossiana Y.L", 
        "Much Fahmi Ns": "Caecilia Renata", 
        "Fadil Fadillah": "Caecilia Renata", 
        "Jumedi": "Fiki Hernawan"
        };

        // Data karyawan dengan department
        const employeeData = [
        {	name:	"Ajar Sono",	department:	"Technic",	atasanLangsung:	"Edwin Qomarudin"	},
        {	name:	"Beni Permana",	department:	"Technic",	atasanLangsung:	"Edwin Qomarudin"	},
        {	name:	"Dede Haryanto",	department:	"Technic",	atasanLangsung:	"Edwin Qomarudin"	},
        {	name:	"Erik Eriyanto",	department:	"Technic",	atasanLangsung:	"Edwin Qomarudin"	},
        {	name:	"Kamil Alfalaq",	department:	"Technic",	atasanLangsung:	"Edwin Qomarudin"	},
        {	name:	"Endang Supriyatna",	department:	"Technic",	atasanLangsung:	"Edwin Qomarudin"	},
        {	name:	"Syaiful Anwar",	department:	"Technic",	atasanLangsung:	"Edwin Qomarudin"	},
        {	name:	"Anis Marzuki",	department:	"Technic",	atasanLangsung:	"Edwin Qomarudin"	},
        {	name:	"Achmadi",	department:	"Technic",	atasanLangsung:	"Edwin Qomarudin"	},
        {	name:	"Ari Sabila Rahman",	department:	"Technic",	atasanLangsung:	"Edwin Qomarudin"	},
        {	name:	"Daniel Saputra",	department:	"Technic",	atasanLangsung:	"Edwin Qomarudin"	},
        {	name:	"Iman Supratman",	department:	"Technic",	atasanLangsung:	"Edwin Qomarudin"	},
        {	name:	"M Irchamu Rozaq",	department:	"Technic",	atasanLangsung:	"Edwin Qomarudin"	},
        {	name:	"Niko Dermawan",	department:	"Technic",	atasanLangsung:	"Edwin Qomarudin"	},
        {	name:	"Novi Irawan",	department:	"Technic",	atasanLangsung:	"Edwin Qomarudin"	},
        {	name:	"Saiful Utomo",	department:	"Technic",	atasanLangsung:	"Edwin Qomarudin"	},
        {	name:	"Ardan Dwiki Ramadhan",	department:	"Technic",	atasanLangsung:	"Edwin Qomarudin"	},
        {	name:	"Adli Syaifulloh",	department:	"Technic",	atasanLangsung:	"Edwin Qomarudin"	},
        {	name:	"Dewi Izzatun Nisa",	department:	"Technic",	atasanLangsung:	"Edwin Qomarudin"	},
        {	name:	"Edi Susilo",	department:	"Technic",	atasanLangsung:	"Edwin Qomarudin"	},
        {	name:	"Gilang Febrianto",	department:	"Technic",	atasanLangsung:	"Edwin Qomarudin"	},
        {	name:	"Rizky Nur Andrea Pratama Putra",	department:	"Technic",	atasanLangsung:	"Edwin Qomarudin"	},
        {	name:	"Redo Saputro",	department:	"Technic",	atasanLangsung:	"Edwin Qomarudin"	},
        {	name:	"A. Khadijah Mauliana SM",	department:	"Technic",	atasanLangsung:	"Edwin Qomarudin"	},
        {	name:	"Muhammad Rizal",	department:	"Technic",	atasanLangsung:	"Edwin Qomarudin"	},
        {	name:	"Bobby Ardi",	department:	"Technic",	atasanLangsung:	"Edwin Qomarudin"	},
        {	name:	"Rahul Suli Mujiburrahman",	department:	"Technic",	atasanLangsung:	"Edwin Qomarudin"	},
        {	name:	"Muhammad Mauliana",	department:	"Technic",	atasanLangsung:	"Edwin Qomarudin"	},
        {	name:	"Abdul Wahab",	department:	"Technic",	atasanLangsung:	"Edwin Qomarudin"	},
        {	name:	"Muhammad Rion Pratama",	department:	"Technic",	atasanLangsung:	"Edwin Qomarudin"	},
        {	name:	"Muhamad Fahmi Zulfikar",	department:	"Technic",	atasanLangsung:	"Edwin Qomarudin"	},
        {	name:	"Indera Septo Wahyudi",	department:	"Technic",	atasanLangsung:	"Edwin Qomarudin"	},
        {	name:	"Ayyub Fathoni",	department:	"Technic",	atasanLangsung:	"Edwin Qomarudin"	},
        {	name:	"Muhamad Rio Ferdiansyah",	department:	"Technic",	atasanLangsung:	"Fiki Hernawan"	},
        {	name:	"Andriyansyah",	department:	"Technic",	atasanLangsung:	"Fiki Hernawan"	},
        {	name:	"Muhammad Farhan Zidan",	department:	"Technic",	atasanLangsung:	"Fiki Hernawan"	},
        {	name:	"Prasetyo Bagaskoro",	department:	"Technic",	atasanLangsung:	"Fiki Hernawan"	},
        {	name:	"Bayu Pambudi",	department:	"Technic",	atasanLangsung:	"Fiki Hernawan"	},
        {	name:	"Elvin Herdiansyah",	department:	"Technic",	atasanLangsung:	"Fiki Hernawan"	},
        {	name:	"Indra Adji Syafalaq",	department:	"Technic",	atasanLangsung:	"Fiki Hernawan"	},
        {	name:	"Junaidi",	department:	"Technic",	atasanLangsung:	"Fiki Hernawan"	},
        {	name:	"Mochamad Rijal Mushthafa",	department:	"Technic",	atasanLangsung:	"Fiki Hernawan"	},
        {	name:	"Muhamad",	department:	"Technic",	atasanLangsung:	"Fiki Hernawan"	},
        {	name:	"Wahyu Maulana",	department:	"Technic",	atasanLangsung:	"Fiki Hernawan"	},
        {	name:	"Dwireza Wirananda",	department:	"Technic",	atasanLangsung:	"Fiki Hernawan"	},
        {	name:	"Wisnu Adi Baskoro",	department:	"Technic",	atasanLangsung:	"Fiki Hernawan"	},
        {	name:	"Alfiansyah Dira Saputra",	department:	"Technic",	atasanLangsung:	"Fiki Hernawan"	},
        {	name:	"Ahmad Zaini",	department:	"Technic",	atasanLangsung:	"Fiki Hernawan"	},
        {	name:	"Sayyid Hidayattulloh",	department:	"Technic",	atasanLangsung:	"Fiki Hernawan"	},
        {	name:	"Muhammad Billal Dhelian Putra",	department:	"Technic",	atasanLangsung:	"Fiki Hernawan"	},
        {	name:	"Agung Santoso",	department:	"Technic",	atasanLangsung:	"Fiki Hernawan"	},
        {	name:	"Edy Amin",	department:	"Technic",	atasanLangsung:	"Fiki Hernawan"	},
        {	name:	"Proboadi Haryo Wicaksono",	department:	"Technic",	atasanLangsung:	"Fiki Hernawan"	},
        {	name:	"Yudiyono",	department:	"Technic",	atasanLangsung:	"Fiki Hernawan"	},
        {	name:	"Indra Kurniawan",	department:	"Technic",	atasanLangsung:	"Fiki Hernawan"	},
        {	name:	"Mochammad Gorwantoro Putra",	department:	"Technic",	atasanLangsung:	"Fiki Hernawan"	},
        {	name:	"Wahyu Sujoko",	department:	"Technic",	atasanLangsung:	"Fiki Hernawan"	},
        {	name:	"Luki Dwi Saputra",	department:	"Technic",	atasanLangsung:	"Fiki Hernawan"	},
        {	name:	"Muhammad Fahmi Haikal",	department:	"Technic",	atasanLangsung:	"Fiki Hernawan"	},
        {	name:	"Ramadhan Nasution",	department:	"Technic",	atasanLangsung:	"Fiki Hernawan"	},
        {	name:	"Muhammad Ripaldi Saputra",	department:	"Technic",	atasanLangsung:	"Fiki Hernawan"	},
        {	name:	"Anggiat Rorizki Galingging",	department:	"Technic",	atasanLangsung:	"Fiki Hernawan"	},
        {	name:	"Abu Faqih Alkafi",	department:	"Technic",	atasanLangsung:	"Fiki Hernawan"	},
        {	name:	"Muhamad Raihan Nurudin",	department:	"Technic",	atasanLangsung:	"Fiki Hernawan"	},
        {	name:	"Agung Ramadhan",	department:	"Technic",	atasanLangsung:	"Fiki Hernawan"	},
        {	name:	"Obay",	department:	"Technic",	atasanLangsung:	"Fiki Hernawan"	},
        {	name:	"Imam Royani",	department:	"Technic",	atasanLangsung:	"Fiki Hernawan"	},
        {	name:	"Dendi Septiawan",	department:	"Technic",	atasanLangsung:	"Fiki Hernawan"	},
        {	name:	"Ajat Sudrajat",	department:	"Technic",	atasanLangsung:	"Fiki Hernawan"	},
        {	name:	"Akbar Sobari",	department:	"Technic",	atasanLangsung:	"Fiki Hernawan"	},
        {	name:	"Nurti Handoyo",	department:	"Technic",	atasanLangsung:	"Fiki Hernawan"	},
        {	name:	"Ramdani Hidayat",	department:	"Technic",	atasanLangsung:	"Fiki Hernawan"	},
        {	name:	"Saefulloh",	department:	"Technic",	atasanLangsung:	"Fiki Hernawan"	},
        {	name:	"Saripudin",	department:	"Technic",	atasanLangsung:	"Fiki Hernawan"	},
        {	name:	"Taufik Krismanto",	department:	"Technic",	atasanLangsung:	"Fiki Hernawan"	},
        {	name:	"Ahmad Fuadi",	department:	"Technic",	atasanLangsung:	"Fiki Hernawan"	},
        {	name:	"Usman",	department:	"Technic",	atasanLangsung:	"Fiki Hernawan"	},
        {	name:	"Tashafani Nurfajrina",	department:	"Technic",	atasanLangsung:	"Fiki Hernawan"	},
        {	name:	"Rizky Pratama",	department:	"Technic",	atasanLangsung:	"Fiki Hernawan"	},
        {	name:	"Gangsar Setya Utama",	department:	"Technic",	atasanLangsung:	"Fiki Hernawan"	},
        {	name:	"Antik Wara Anandiah",	department:	"Technic",	atasanLangsung:	"Fiki Hernawan"	},
        {	name:	"Raka Martyohady",	department:	"Technic",	atasanLangsung:	"Fiki Hernawan"	},
        {	name:	"Jimmy Alfian Syahputra",	department:	"Technic",	atasanLangsung:	"Fiki Hernawan"	},
        {	name:	"Saepul Bahri",	department:	"Technic",	atasanLangsung:	"Fiki Hernawan"	},
        {	name:	"Riski Ibrahim",	department:	"Technic",	atasanLangsung:	"Fiki Hernawan"	},
        {	name:	"Muhamad Nurfaizi",	department:	"Technic",	atasanLangsung:	"Fiki Hernawan"	},
        {	name:	"Ibnu Pangestu",	department:	"Technic",	atasanLangsung:	"Fiki Hernawan"	},
        {	name:	"Fiki Septiawan",	department:	"Technic",	atasanLangsung:	"Fiki Hernawan"	},
        {	name:	"Khoirul Anam",	department:	"Technic",	atasanLangsung:	"Fiki Hernawan"	},
        {	name:	"Rudi Hartono",	department:	"Technic",	atasanLangsung:	"Fiki Hernawan"	},
        {	name:	"Asep Saepulloh",	department:	"Technic",	atasanLangsung:	"Fiki Hernawan"	},
        {	name:	"Ilman",	department:	"Technic",	atasanLangsung:	"Fiki Hernawan"	},
        {	name:	"Suhendar",	department:	"Technic",	atasanLangsung:	"Fiki Hernawan"	},
        {	name:	"Yusron Ali Nasution",	department:	"Technic",	atasanLangsung:	"Fiki Hernawan"	},
        {	name:	"Tri Teguh Rahmanto",	department:	"Technic",	atasanLangsung:	"Fiki Hernawan"	},
        {	name:	"Aries A Bastian",	department:	"Technic",	atasanLangsung:	"Fiki Hernawan"	},
        {	name:	"DIMAS",	department:	"Technic",	atasanLangsung:	"Fiki Hernawan"	},
        {	name:	"Robiyanto",	department:	"Technic",	atasanLangsung:	"Fiki Hernawan"	},
        {	name:	"Taufiq Ocktafianto",	department:	"Technic",	atasanLangsung:	"Fiki Hernawan"	},
        {	name:	"Regandi",	department:	"Technic",	atasanLangsung:	"Fiki Hernawan"	},
        {	name:	"Adha Ripanggi",	department:	"Technic",	atasanLangsung:	"Fiki Hernawan"	},
        {	name:	"M Jakaria",	department:	"Technic",	atasanLangsung:	"Fiki Hernawan"	},
        {	name:	"Supriyan",	department:	"Technic",	atasanLangsung:	"Fiki Hernawan"	},
        {	name:	"Ismail Septiadi",	department:	"Technic",	atasanLangsung:	"Fiki Hernawan"	},
        {	name:	"Muhammad Imam Sueb",	department:	"Technic",	atasanLangsung:	"Fiki Hernawan"	},
        {	name:	"Muhamad Razka  Ariq Fadillah",	department:	"Technic",	atasanLangsung:	"Fiki Hernawan"	},
        {	name:	"Bintang Timur Ramadhan",	department:	"Technic",	atasanLangsung:	"Fiki Hernawan"	},
        {	name:	"Rifqi Zaky Ramadhani",	department:	"Technic",	atasanLangsung:	"Fiki Hernawan"	},
        {	name:	"Fauzy Maulana Saputra",	department:	"Technic",	atasanLangsung:	"Fiki Hernawan"	},
        {	name:	"Andreansyah Wibowo",	department:	"Technic",	atasanLangsung:	"Fiki Hernawan"	},
        {	name:	"Muhammad Alfarizi Abigail",	department:	"Technic",	atasanLangsung:	"Fiki Hernawan"	},
        {	name:	"Arif Rahman",	department:	"Technic",	atasanLangsung:	"Fiki Hernawan"	},
        {	name:	"Muhammad Ikhsan",	department:	"Technic",	atasanLangsung:	"Fiki Hernawan"	},
        {	name:	"I Gede Diartika Mahayasa",	department:	"Technic",	atasanLangsung:	"Fiki Hernawan"	},
        {	name:	"Mukhsinun",	department:	"Technic",	atasanLangsung:	"Fiki Hernawan"	},
        {	name:	"Yogi Widodo",	department:	"Technic",	atasanLangsung:	"Fiki Hernawan"	},
        {	name:	"I Wayan Windhu Winarta",	department:	"Technic",	atasanLangsung:	"Fiki Hernawan"	},
        {	name:	"Bagas Kurniawan",	department:	"Technic",	atasanLangsung:	"Fiki Hernawan"	},
        {	name:	"Alvin Khoirur Rokhim",	department:	"Technic",	atasanLangsung:	"Fiki Hernawan"	},
        {	name:	"Muhamad Rivaldi Putra Pamungkas",	department:	"Technic",	atasanLangsung:	"Fiki Hernawan"	},
        {	name:	"Burhadi",	department:	"Technic",	atasanLangsung:	"Fiki Hernawan"	},
        {	name:	"Ruli Adiyono",	department:	"Technic",	atasanLangsung:	"Fiki Hernawan"	},
        {	name:	"Sohibul Mubarok",	department:	"Technic",	atasanLangsung:	"Fiki Hernawan"	},
        {	name:	"mohamad husnal falah",	department:	"Technic",	atasanLangsung:	"Fiki Hernawan"	},
        {	name:	"Muhamad Fauji",	department:	"Technic",	atasanLangsung:	"Fiki Hernawan"	},
        {	name:	"Dwi Maya Alfiany",	department:	"Technic",	atasanLangsung:	"Fiki Hernawan"	},
        {	name:	"Chyndi Ananda Putri",	department:	"Technic",	atasanLangsung:	"Fiki Hernawan"	},
        {	name:	"Izbullah Nasution",	department:	"Technic",	atasanLangsung:	"Fiki Hernawan"	},
        {	name:	"Sahrul Hidayat",	department:	"Technic",	atasanLangsung:	"Fiki Hernawan"	},
        {	name:	"Agrian Rahmat Ayubi",	department:	"Technic",	atasanLangsung:	"Fiki Hernawan"	},
        {	name:	"Salman Alfaritsi Bakhtiar",	department:	"Technic",	atasanLangsung:	"Fiki Hernawan"	},
        {	name:	"Joko Sarwono",	department:	"Technic",	atasanLangsung:	"Heksi Prasetyo"	},
        {	name:	"Andi Suroso",	department:	"Technic",	atasanLangsung:	"Heksi Prasetyo"	},
        {	name:	"Triot Susanto",	department:	"Technic",	atasanLangsung:	"Heksi Prasetyo"	},
        {	name:	"Sensen Imran Abdillah",	department:	"Technic",	atasanLangsung:	"Heksi Prasetyo"	},
        {	name:	"Hery Syah Putra",	department:	"Technic",	atasanLangsung:	"Heksi Prasetyo"	},
        {	name:	"Anisa Nur Avivah",	department:	"Technic",	atasanLangsung:	"Muhamad Husni"	},
        {	name:	"Fiki Hernawan",	department:	"Technic",	atasanLangsung:	"Muhamad Husni"	},
        {	name:	"Heksi Prasetyo",	department:	"Technic",	atasanLangsung:	"Muhamad Husni"	},
        {	name:	"Mareta Sri Setiati",	department:	"Technic",	atasanLangsung:	"Muhamad Husni"	},
        {	name:	"Edwin Qomarudin",	department:	"Technic",	atasanLangsung:	"Muhamad Husni"	},
        {	name:	"Mohammad Ardiyanto",	department:	"Engineering",	atasanLangsung:	"Wahyu YIB"	},
        {	name:	"Dhona Purnomo",	department:	"Engineering",	atasanLangsung:	"Wahyu YIB"	},
        {	name:	"Dwi Kartika Ningsih Z",	department:	"Engineering",	atasanLangsung:	"Wahyu YIB"	},
        {	name:	"Arifa Nurhayati",	department:	"Engineering",	atasanLangsung:	"Wahyu YIB"	},
        {	name:	"Kurniawan Febrianto",	department:	"Engineering",	atasanLangsung:	"Wahyu YIB"	},
        {	name:	"Anggita Septiani",	department:	"Finance",	atasanLangsung:	"Caecilia Renata"	},
        {	name:	"Brahmantyo Hadiprasetyo",	department:	"Sales",	atasanLangsung:	"Caecilia Renata"	},
        {	name:	"Muhamad Husni",	department:	"Technic",	atasanLangsung:	"Caecilia Renata"	},
        {	name:	"Caecilia Renata Harsobisono",	department:	"HR",	atasanLangsung:	"Caecilia Renata"	},
        {	name:	"Rossiana Yunita Lampung",	department:	"Purchasing",	atasanLangsung:	"Caecilia Renata"	},
        {	name:	"Reni Nurhayati",	department:	"Finance",	atasanLangsung:	"Anggita Septiani"	},
        {	name:	"Salsabila Anisah Putri Farihah",	department:	"Finance",	atasanLangsung:	"Anggita Septiani"	},
        {	name:	"Nurmala Dewi",	department:	"Finance",	atasanLangsung:	"Anggita Septiani"	},
        {	name:	"Danny",	department:	"Finance",	atasanLangsung:	"Anggita Septiani"	},
        {	name:	"Maria Angelina",	department:	"Finance",	atasanLangsung:	"Anggita Septiani"	},
        {	name:	"Lie Sani",	department:	"Finance",	atasanLangsung:	"Anggita Septiani"	},
        {	name:	"Athania Mahardiyanti",	department:	"Finance",	atasanLangsung:	"Anggita Septiani"	},
        {	name:	"Sely Megawati Wahyudi",	department:	"Finance",	atasanLangsung:	"Anggita Septiani"	},
        {	name:	"Iskandar Bagus Wahyu Yuwono",	department:	"Engineering",	atasanLangsung:	"Caecilia Renata"	},
        {	name:	"David Tides Sagita",	department:	"Sales",	atasanLangsung:	"Caecilia Renata"	},
        {	name:	"Ulandari",	department:	"HR",	atasanLangsung:	"Caecilia Renata"	},
        {	name:	"Putri Safira",	department:	"HR",	atasanLangsung:	"Caecilia Renata"	},
        {	name:	"Winda Arwanti",	department:	"HR",	atasanLangsung:	"Caecilia Renata"	},
        {	name:	"Galih Satrio",	department:	"HR",	atasanLangsung:	"Caecilia Renata"	},
        {	name:	"Siti Astuti",	department:	"HR",	atasanLangsung:	"Caecilia Renata"	},
        {	name:	"Nurhidayat",	department:	"Sales",	atasanLangsung:	"David Tides Sagita"	},
        {	name:	"Ahmad Asyrory",	department:	"Sales",	atasanLangsung:	"David Tides Sagita"	},
        {	name:	"Andy Rahman",	department:	"Sales",	atasanLangsung:	"David Tides Sagita"	},
        {	name:	"Dhea Stephanie Gazali",	department:	"Sales",	atasanLangsung:	"David Tides Sagita"	},
        {	name:	"Pamungkas Tri Sulistiyono",	department:	"Sales",	atasanLangsung:	"David Tides Sagita"	},
        {	name:	"Rangga Riseto",	department:	"Sales",	atasanLangsung:	"David Tides Sagita"	},
        {	name:	"Bintang Norys Pambudy",	department:	"Sales",	atasanLangsung:	"David Tides Sagita"	},
        {	name:	"Arjulu Fadila Nurrahman",	department:	"Technic",	atasanLangsung:	"Fiki Hernawan"	},
        {	name:	"Muhamad Afriyansah",	department:	"Technic",	atasanLangsung:	"Fiki Hernawan"	},
        {	name:	"Ahmad Rohendi",	department:	"Technic",	atasanLangsung:	"Fiki Hernawan"	},
        {	name:	"Wildan Rizki Ramadhan",	department:	"Technic",	atasanLangsung:	"Fiki Hernawan"	},
        {	name:	"Ika Rahma Diastiara",	department:	"Technic",	atasanLangsung:	"Edwin Qomarudin"	},
        {	name:	"Qosim Cahyo Ihsan Nurdin",	department:	"Technic",	atasanLangsung:	"Edwin Qomarudin"	},
        {	name:	"Indi Nurul Hidayah",	department:	"Technic",	atasanLangsung:	"Edwin Qomarudin"	},
        {	name:	"Moh. Syafrudin",	department:	"Technic",	atasanLangsung:	"Edwin Qomarudin"	},
        {	name:	"Rokhmat Mulyoko",	department:	"Technic",	atasanLangsung:	"Edwin Qomarudin"	},
        {	name:	"Lies Setyowati",	department:	"Technic",	atasanLangsung:	"Edwin Qomarudin"	},
        {	name:	"Harianto",	department:	"Technic",	atasanLangsung:	"Edwin Qomarudin"	},
        {	name:	"Achmad Fadhilah",	department:	"Finance",	atasanLangsung:	"Anggita Septiani"	},
        {	name:	"Wahyu Ardiansyah",	department:	"Finance",	atasanLangsung:	"Anggita Septiani"	},
        {	name:	"Sarju",	department:	"Purchasing",	atasanLangsung:	"Rossiana Y.L"	},
        {	name:	"Anggina Herbimaya",	department:	"Purchasing",	atasanLangsung:	"Rossiana Y.L"	},
        {	name:	"Evi Komalasari",	department:	"Purchasing",	atasanLangsung:	"Rossiana Y.L"	},
        {	name:	"Maida Faza Kusnadi",	department:	"Purchasing",	atasanLangsung:	"Rossiana Y.L"	},
        {	name:	"Apriadi",	department:	"Purchasing",	atasanLangsung:	"Rossiana Y.L"	},
        {	name:	"Mawarto N",	department:	"Purchasing",	atasanLangsung:	"Rossiana Y.L"	},
        {	name:	"Abdul Kafi",	department:	"Purchasing",	atasanLangsung:	"Rossiana Y.L"	},
        {	name:	"Abdul Rahman",	department:	"Purchasing",	atasanLangsung:	"Rossiana Y.L"	},
        {	name:	"Mashadi",	department:	"Purchasing",	atasanLangsung:	"Rossiana Y.L"	},
        {	name:	"Much Fahmi Ns",	department:	"HR",	atasanLangsung:	"Caecilia Renata"	},
        {	name:	"Fadil Fadillah",	department:	"HR",	atasanLangsung:	"Caecilia Renata"	},
        {	name:	"Jumedi",	department:	"Technic",	atasanLangsung:	"Fiki Hernawan"	}

        ];

        // Fungsi untuk mendapatkan semua nama karyawan (unik)
        function getAllEmployeeNames() {
            return [...new Set(employeeData.map(emp => emp.name))];
        }

        // Fungsi untuk mendapatkan departemen berdasarkan nama
        function getDepartmentByName(employeeName) {
            const employee = employeeData.find(emp => emp.name === employeeName);
            return employee ? employee.department : '';
        }

        // Fungsi untuk mendapatkan atasan langsung berdasarkan nama
        function getAtasanLangsungByName(employeeName) {
            const employee = employeeData.find(emp => emp.name === employeeName);
            return employee ? employee.atasanLangsung : '';
        }

        // Fungsi untuk mendapatkan daftar approver berdasarkan nilai request - MODIFIED FOR TECHNIC
        function getApprovedByForRequest(employeeName, nilaiRequest) {
            const atasanLangsung = getAtasanLangsungByName(employeeName);
            const department = getDepartmentByName(employeeName);
            
            // Untuk departemen Technic: tambahkan Muhamad Husni sebagai approver tambahan
            if (department === "Technic") {
                if (nilaiRequest === "Bawah 1jt") {
                    // Atasan langsung + Muhamad Husni untuk Technic
                    return [atasanLangsung, "Muhamad Husni"];
                } else if (nilaiRequest === "Atas 1jt") {
                    // Atasan langsung + Muhamad Husni + Caecilia Renata untuk Technic
                    return [atasanLangsung, "Muhamad Husni", "Caecilia Renata"];
                }
            } else {
                // Untuk departemen lain, tetap seperti semula
                if (nilaiRequest === "Bawah 1jt") {
                    return [atasanLangsung];
                } else if (nilaiRequest === "Atas 1jt") {
                    return [atasanLangsung, "Caecilia Renata"];
                }
            }
            
            return [atasanLangsung];
        }
        // Fungsi untuk mendapatkan daftar approver untuk request IT - MODIFIED FOR TECHNIC
        function getApprovedByForITRequest(employeeName) {
            const atasanLangsung = getAtasanLangsungByName(employeeName);
            const department = getDepartmentByName(employeeName);
            
            // Untuk departemen Technic: tambahkan Muhamad Husni
            if (department === "Technic") {
                return [atasanLangsung, "Muhamad Husni", "Galih", "Maida", "Caecilia Renata", "Rossiana Y.L"];
            } else {
                // Untuk departemen lain, tetap seperti semula
                return [atasanLangsung, "Galih", "Maida", "Caecilia Renata", "Rossiana Y.L"];
            }
        }

        // Fungsi untuk mencari karyawan berdasarkan query
        function searchEmployees(query) {
            const lowerQuery = query.toLowerCase();
            return employeeData.filter(emp => 
                emp.name.toLowerCase().includes(lowerQuery)
            );
        }

        // Fungsi untuk inisialisasi autocomplete pada input
        function initializeAutocomplete(inputElement, departmentElement = null) {
            // Buat container untuk dropdown autocomplete
            const autocompleteContainer = document.createElement('div');
            autocompleteContainer.className = 'autocomplete-dropdown';
            autocompleteContainer.style.cssText = `
                position: absolute;
                background: white;
                border: 1px solid #e2e8f0;
                border-radius: 0.5rem;
                max-height: 200px;
                overflow-y: auto;
                z-index: 1000;
                width: 100%;
                box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
                display: none;
            `;
            
            // Sisipkan dropdown setelah input
            inputElement.parentNode.style.position = 'relative';
            inputElement.parentNode.appendChild(autocompleteContainer);
            
            let currentFocus = -1;
            
            // Event listener untuk input
            inputElement.addEventListener('input', function(e) {
                const value = this.value;
                autocompleteContainer.innerHTML = '';
                currentFocus = -1;
                
                if (value.length < 2) {
                    autocompleteContainer.style.display = 'none';
                    return;
                }
                
                const results = searchEmployees(value);
                
                if (results.length === 0) {
                    autocompleteContainer.style.display = 'none';
                    return;
                }
                
                results.forEach(employee => {
                    const item = document.createElement('div');
                    item.innerHTML = `
                        <div style="padding: 10px; cursor: pointer; border-bottom: 1px solid #f1f5f9;">
                            <strong>${employee.name}</strong>
                            <div style="font-size: 0.8rem; color: #64748b;">${employee.department}</div>
                            <div style="font-size: 0.7rem; color: #3b82f6;">Atasan: ${employee.atasanLangsung}</div>
                        </div>
                    `;
                    
                    item.addEventListener('click', function() {
                        inputElement.value = employee.name;
                        if (departmentElement) {
                            departmentElement.value = employee.department;
                        }
                        autocompleteContainer.style.display = 'none';
                        
                        // Trigger change event untuk form validation
                        inputElement.dispatchEvent(new Event('change', { bubbles: true }));
                        if (departmentElement) {
                            departmentElement.dispatchEvent(new Event('change', { bubbles: true }));
                        }
                    });
                    
                    autocompleteContainer.appendChild(item);
                });
                
                autocompleteContainer.style.display = 'block';
            });
            
            // Event listener untuk keyboard navigation
            inputElement.addEventListener('keydown', function(e) {
                const items = autocompleteContainer.getElementsByTagName('div');
                
                if (e.keyCode === 40) { // Arrow down
                    currentFocus++;
                    addActive(items);
                } else if (e.keyCode === 38) { // Arrow up
                    currentFocus--;
                    addActive(items);
                } else if (e.keyCode === 13) { // Enter
                    e.preventDefault();
                    if (currentFocus > -1) {
                        if (items[currentFocus]) items[currentFocus].click();
                    }
                }
            });
            
            function addActive(items) {
                if (!items) return false;
                removeActive(items);
                
                if (currentFocus >= items.length) currentFocus = 0;
                if (currentFocus < 0) currentFocus = items.length - 1;
                
                items[currentFocus].classList.add('autocomplete-active');
                items[currentFocus].style.backgroundColor = '#3b82f6';
                items[currentFocus].style.color = 'white';
            }
            
            function removeActive(items) {
                for (let i = 0; i < items.length; i++) {
                    items[i].classList.remove('autocomplete-active');
                    items[i].style.backgroundColor = '';
                    items[i].style.color = '';
                }
            }
            
            // Sembunyikan dropdown ketika klik di luar
            document.addEventListener('click', function(e) {
                if (!inputElement.contains(e.target) && !autocompleteContainer.contains(e.target)) {
                    autocompleteContainer.style.display = 'none';
                }
            });
        }

        // Fungsi untuk inisialisasi semua autocomplete di aplikasi
        function initializeAllAutocompletes() {
            console.log('Initializing autocomplete features...');
            
            // Mapping antara field nama dan department untuk setiap form
            const formMappings = [
                // Form ATK
                { 
                    nameField: 'atk-nama', 
                    departmentField: 'atk-department' 
                },
                // Form ID Card
                { 
                    nameField: 'idcard-nama', 
                    departmentField: 'idcard-department' 
                },
                // Form Konsumsi
                { 
                    nameField: 'konsumsi-nama', 
                    departmentField: 'konsumsi-department' 
                },
                // Form Laptop
                { 
                    nameField: 'laptop-nama', 
                    departmentField: 'laptop-department' 
                },
                // Form Kartu Nama
                { 
                    nameField: 'kartunama-nama', 
                    departmentField: 'kartunama-department' 
                },
                // Form Feedback
                { 
                    nameField: 'feedback-nama', 
                    departmentField: 'feedback-department' 
                }
            ];
            
            // Inisialisasi autocomplete untuk setiap mapping
            formMappings.forEach(mapping => {
                const nameField = document.getElementById(mapping.nameField);
                const departmentField = document.getElementById(mapping.departmentField);
                
                if (nameField) {
                    initializeAutocomplete(nameField, departmentField);
                    console.log(`Autocomplete initialized for: ${mapping.nameField}`);
                }
            });
        }

        // Auto-initialize ketika DOM siap
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initializeAllAutocompletes);
        } else {
            initializeAllAutocompletes();
        }
    </script>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Firebase Configuration
            const firebaseConfig = {
                apiKey: "AIzaSyDihA-hrOGbYojWc9WLwYFi207XoOtfjuU",
                authDomain: "generalaffair-d18ce.firebaseapp.com",
                projectId: "generalaffair-d18ce",
                storageBucket: "generalaffair-d18ce.firebasestorage.app",
                messagingSenderId: "726107738231",
                appId: "1:726107738231:web:8385b1fa08994a2a06f672"
            };

            // Initialize Firebase
            firebase.initializeApp(firebaseConfig);
            const auth = firebase.auth();
            const db = firebase.firestore();

            // Mapping email ke nama
            const emailToNameMap = {
                'galih@genetek.co.id': 'Galih',
                'crenata@genetek.co.id': 'Caecilia Renata',
                'rossiana.yl@genetek.co.id': 'Rossiana Y.L',
                'maida@genetek.co.id': 'Maida',
                'ulandari@genetek.co.id': 'Ulan',
                'm_husni@genetek.co.id': 'Muhamad Husni',
                'anggita-s@genetek.co.id': 'Anggita Septiani',
                'wahyu_yib@genetek.co.id': 'Wahyu YIB',
                'david@genetek.co.id': 'David Tides Sagita',
                'edwin@genetek.co.id': 'Edwin Qomarudin',
                'heksi@genetek.co.id': 'Heksi Prasetyo',
                'fikihernawan@genetek.co.id': 'Fiki Hernawan'
            };

            // User permissions mapping
            const userPermissions = {
                'ulandari@genetek.co.id': {
                    name: 'Ulan',
                    allowedForms: ['atk', 'idcard', 'konsumsi', 'kartunama']
                },
                'crenata@genetek.co.id': {
                    name: 'Caecilia Renata',
                    allowedForms: ['atk', 'idcard', 'konsumsi', 'laptop', 'feedback', 'kartunama']
                },
                'galih@genetek.co.id': {
                    name: 'Galih',
                    allowedForms: ['laptop']
                },
                'maida@genetek.co.id': {
                    name: 'Maida',
                    allowedForms: ['laptop']
                },
                'rossiana.yl@genetek.co.id': {
                    name: 'Rossiana Y.L',
                    allowedForms: ['atk', 'laptop']
                },
                'm_husni@genetek.co.id': {
                    name: 'Muhamad Husni',
                    allowedForms: ['atk', 'laptop']
                },
                'anggita-s@genetek.co.id': {
                    name: 'Anggita Septiani',
                    allowedForms: ['atk', 'laptop']
                },
                'wahyu_yib@genetek.co.id': {
                    name: 'Wahyu YIB',
                    allowedForms: ['atk', 'laptop']
                },
                'david@genetek.co.id': {
                    name: 'David Tides Sagita',
                    allowedForms: ['atk', 'laptop']
                },
                'edwin@genetek.co.id': {
                    name: 'Edwin Qomarudin',
                    allowedForms: ['atk', 'laptop']
                },
                'heksi@genetek.co.id': {
                    name: 'Heksi Prasetyo',
                    allowedForms: ['atk', 'laptop']
                },
                'fikihernawan@genetek.co.id': {
                    name: 'Fiki Hernawan',
                    allowedForms: ['atk', 'laptop']
                }
            };

            // ========== SISTEM NOTIFIKASI REAL-TIME YANG DISEMPURNAKAN ==========
            
            let notificationUnsubscribeFunctions = [];
            let lastNotificationCheck = {};
            const BROWSER_NOTIFICATION_COOLDOWN = 30000;

            // Function untuk memuat semua notifikasi user - OPTIMIZED
            function loadAllUserNotifications(userEmail) {
                console.log(`Memuat semua notifikasi untuk: ${userEmail}`);
                
                if (!userEmail) return;
                
                const userName = emailToNameMap[userEmail] || userEmail.split('@')[0];
                let allNotifications = [];
                
                // 1. Load notifikasi dari user_notifications collection (untuk Ulan)
                const ulanNotificationsPromise = userEmail === 'ulandari@genetek.co.id' ? 
                    db.collection('user_notifications')
                        .where('userId', '==', userEmail)
                        .orderBy('createdAt', 'desc')
                        .limit(20)
                        .get()
                        .then((querySnapshot) => {
                            querySnapshot.forEach((doc) => {
                                const data = doc.data();
                                allNotifications.push({
                                    id: `notif_${doc.id}`,
                                    formType: data.formType || 'atk',
                                    requestId: data.requestId,
                                    request: {
                                        nama: data.message.includes('dari') ? 
                                              data.message.split('dari')[1]?.split('(')[0]?.trim() || 'User' : 'User',
                                        status: data.type === 'new_request' ? 'pending' : 'approved'
                                    },
                                    timestamp: data.createdAt ? data.createdAt.toDate() : new Date(),
                                    read: data.isRead || false,
                                    isNew: !data.isRead,
                                    notificationType: data.type,
                                    originalMessage: data.message,
                                    title: data.title,
                                    isUlanNotification: true
                                });
                            });
                        }) : Promise.resolve();

                // 2. Load notifikasi dari requests collection (untuk semua user)
                const formTypes = ['atk', 'idcard', 'konsumsi', 'laptop', 'kartunama', 'feedback'];
                const requestsPromises = formTypes.map(formType => {
                    return db.collection(`requests_${formType}`)
                        .orderBy('createdAt', 'desc')
                        .limit(30)
                        .get()
                        .then((querySnapshot) => {
                            querySnapshot.forEach((doc) => {
                                const request = { id: doc.id, formType, ...doc.data() };
                                
                                if (isNotificationRelevant(request, userName, userEmail)) {
                                    const notificationId = `${formType}_${doc.id}_${userEmail}`;
                                    const isNew = isNewNotification(notificationId, request);
                                    
                                    allNotifications.push({
                                        id: notificationId,
                                        formType,
                                        requestId: doc.id,
                                        request,
                                        timestamp: request.createdAt ? request.createdAt.toDate() : new Date(),
                                        read: getNotificationReadStatus(notificationId),
                                        isNew: isNew,
                                        isUlanNotification: false
                                    });
                                }
                            });
                        });
                });
                
                Promise.all([ulanNotificationsPromise, ...requestsPromises])
                    .then(() => {
                        // Sort semua notifikasi berdasarkan timestamp
                        allNotifications.sort((a, b) => b.timestamp - a.timestamp);
                        
                        // Tampilkan notifikasi di UI
                        displayGroupedNotifications(allNotifications);
                        
                        // Update badge notifikasi
                        updateNotificationCount(allNotifications);
                        
                        // Update last check time
                        lastNotificationCheck[userEmail] = new Date();
                    })
                    .catch((error) => {
                        console.error("Error loading all notifications:", error);
                    });
            }

            // Function untuk initialize realtime notifications - IMPROVED
            function initializeRealtimeNotifications(userEmail) {
                if (!userEmail) return;
                
                console.log(`Initializing realtime notifications for: ${userEmail}`);
                
                // Clear existing listeners
                notificationUnsubscribeFunctions.forEach(unsubscribe => unsubscribe());
                notificationUnsubscribeFunctions = [];
                
                // Get all form types
                const formTypes = ['atk', 'idcard', 'konsumsi', 'laptop', 'kartunama', 'feedback'];
                
                // Create realtime listeners for each form type - IMPROVED
                formTypes.forEach(formType => {
                    const unsubscribe = db.collection(`requests_${formType}`)
                        .orderBy('createdAt', 'desc')
                        .limit(50)
                        .onSnapshot((querySnapshot) => {
                            console.log(`Realtime update detected for ${formType}`, querySnapshot.size, 'documents');
                            
                            // Check if there are any changes
                            querySnapshot.docChanges().forEach(change => {
                                if (change.type === 'added' || change.type === 'modified') {
                                    console.log(`Change detected in ${formType}:`, change.type, change.doc.data());
                                }
                            });
                            
                            // Refresh notifications
                            loadAllUserNotifications(userEmail);
                            
                            // Show browser notification for new items
                            showBrowserNotificationForNewItems(querySnapshot, userEmail);
                        }, (error) => {
                            console.error(`Error in realtime listener for ${formType}:`, error);
                        });
                    
                    notificationUnsubscribeFunctions.push(unsubscribe);
                });
                
                // Real-time listener untuk user_notifications (khusus Ulan) - IMPROVED
                if (userEmail === 'ulandari@genetek.co.id') {
                    const ulanUnsubscribe = db.collection('user_notifications')
                        .where('userId', '==', 'ulandari@genetek.co.id')
                        .orderBy('createdAt', 'desc')
                        .limit(20)
                        .onSnapshot((querySnapshot) => {
                            console.log('Realtime update for Ulan notifications', querySnapshot.size, 'notifications');
                            
                            querySnapshot.docChanges().forEach(change => {
                                if (change.type === 'added') {
                                    console.log('New notification for Ulan:', change.doc.data());
                                }
                            });
                            
                            loadAllUserNotifications(userEmail);
                        }, (error) => {
                            console.error('Error in Ulan notifications listener:', error);
                        });
                    
                    notificationUnsubscribeFunctions.push(ulanUnsubscribe);
                }
                
                console.log(`Realtime notifications initialized with ${notificationUnsubscribeFunctions.length} listeners`);
            }

            // Function untuk menampilkan browser notification - NEW
            function showBrowserNotificationForNewItems(querySnapshot, userEmail) {
                if (!('Notification' in window) || Notification.permission !== 'granted') {
                    return;
                }
                
                const currentTime = new Date();
                const cooldownKey = `notificationCooldown_${userEmail}`;
                const lastNotificationTime = localStorage.getItem(cooldownKey);
                
                // Cek cooldown (30 detik)
                if (lastNotificationTime && (currentTime - new Date(lastNotificationTime)) < BROWSER_NOTIFICATION_COOLDOWN) {
                    return;
                }
                
                let newItemsCount = 0;
                let latestItem = null;
                
                querySnapshot.docChanges().forEach(change => {
                    if (change.type === 'added') {
                        const data = change.doc.data();
                        const itemTime = data.createdAt ? data.createdAt.toDate() : new Date();
                        
                        // Cek jika item benar-benar baru (dibuat dalam 2 menit terakhir)
                        if ((currentTime - itemTime) < 120000) {
                            newItemsCount++;
                            if (!latestItem || itemTime > latestItem.timestamp) {
                                latestItem = {
                                    data: data,
                                    timestamp: itemTime,
                                    formType: change.doc.ref.parent.id.replace('requests_', '')
                                };
                            }
                        }
                    }
                });
                
                if (newItemsCount > 0 && latestItem) {
                    const formTitle = getFormTitle(latestItem.formType);
                    const notificationTitle = `Request ${formTitle} Baru`;
                    const notificationBody = latestItem.data.nama ? 
                        `Request dari ${latestItem.data.nama}` : 
                        `Ada ${newItemsCount} request baru`;
                    
                    new Notification(notificationTitle, {
                        body: notificationBody,
                        icon: '/favicon.ico',
                        tag: 'new-request'
                    });
                    
                    // Update cooldown
                    localStorage.setItem(cooldownKey, currentTime.toISOString());
                }
            }

            // Function untuk menampilkan notifikasi dengan grouping
            function displayGroupedNotifications(notifications) {
                const notificationList = document.getElementById('notification-list');
                if (!notificationList) return;
                
                if (notifications.length === 0) {
                    notificationList.innerHTML = `
                        <div class="notification-empty">
                            <i class="fas fa-bell-slash"></i>
                            <p>Tidak ada notifikasi</p>
                        </div>
                    `;
                    return;
                }
                
                const groups = groupNotificationsByTime(notifications);
                notificationList.innerHTML = '';
                
                // Today
                if (groups.today.length > 0) {
                    const groupTitle = document.createElement('div');
                    groupTitle.className = 'notification-group-title';
                    groupTitle.textContent = 'Hari Ini';
                    notificationList.appendChild(groupTitle);
                    
                    groups.today.forEach(notification => {
                        createNotificationElement(notification);
                    });
                }
                
                // Yesterday
                if (groups.yesterday.length > 0) {
                    const groupTitle = document.createElement('div');
                    groupTitle.className = 'notification-group-title';
                    groupTitle.textContent = 'Kemarin';
                    notificationList.appendChild(groupTitle);
                    
                    groups.yesterday.forEach(notification => {
                        createNotificationElement(notification);
                    });
                }
                
                // This Week
                if (groups.thisWeek.length > 0) {
                    const groupTitle = document.createElement('div');
                    groupTitle.className = 'notification-group-title';
                    groupTitle.textContent = 'Minggu Ini';
                    notificationList.appendChild(groupTitle);
                    
                    groups.thisWeek.forEach(notification => {
                        createNotificationElement(notification);
                    });
                }
                
                // Older
                if (groups.older.length > 0) {
                    const groupTitle = document.createElement('div');
                    groupTitle.className = 'notification-group-title';
                    groupTitle.textContent = 'Lebih Lama';
                    notificationList.appendChild(groupTitle);
                    
                    groups.older.forEach(notification => {
                        createNotificationElement(notification);
                    });
                }
            }

            // Function untuk membuat elemen notifikasi
            function createNotificationElement(notification) {
                const notificationList = document.getElementById('notification-list');
                if (!notificationList) return;
                
                const notificationElement = document.createElement('div');
                notificationElement.className = `notification-item ${notification.read ? 'read' : 'unread'}`;
                notificationElement.dataset.notificationId = notification.id;
                notificationElement.dataset.formType = notification.formType;
                notificationElement.dataset.requestId = notification.requestId;
                
                const { iconClass, message, isImportant } = getNotificationContent(notification);
                const timeAgo = getTimeAgo(notification.timestamp);
                
                // Tambahkan badge "BARU" untuk notifikasi yang benar-benar baru
                const newBadge = notification.isNew && !notification.read ? 
                    '<span class="new-badge">BARU</span>' : '';
                
                notificationElement.innerHTML = `
                    <div class="notification-icon ${iconClass} ${isImportant ? 'important' : ''}">
                        <i class="fas ${iconClass === 'approved' ? 'fa-check' : iconClass === 'rejected' ? 'fa-times' : 'fa-clock'}"></i>
                    </div>
                    <div class="notification-content">
                        <div class="notification-message">
                            ${newBadge}
                            ${message}
                        </div>
                        <div class="notification-time">${timeAgo}</div>
                    </div>
                    ${!notification.read ? '<div class="unread-indicator"></div>' : ''}
                `;
                
                // Add click event to navigate to relevant form
                notificationElement.addEventListener('click', function() {
                    handleNotificationClick(this, notification);
                });
                
                notificationList.appendChild(notificationElement);
            }

            // Function untuk handle klik notifikasi
            function handleNotificationClick(notificationElement, notification) {
                const formType = notificationElement.dataset.formType;
                const requestId = notificationElement.dataset.requestId;
                const notificationId = notificationElement.dataset.notificationId;
                
                // Mark as read hanya untuk notifikasi non-Ulan
                if (!notification.isUlanNotification) {
                    markNotificationAsRead(notificationId);
                    notificationElement.classList.remove('unread');
                    notificationElement.classList.add('read');
                    notificationElement.querySelector('.unread-indicator')?.remove();
                    notificationElement.querySelector('.new-badge')?.remove();
                } else {
                    // Untuk notifikasi Ulan, update status di Firestore
                    const originalNotificationId = notificationId.replace('notif_', '');
                    db.collection('user_notifications').doc(originalNotificationId).update({
                        isRead: true
                    }).then(() => {
                        console.log('Notifikasi Ulan ditandai sebagai sudah dibaca');
                        notificationElement.classList.remove('unread');
                        notificationElement.classList.add('read');
                        notificationElement.querySelector('.unread-indicator')?.remove();
                        notificationElement.querySelector('.new-badge')?.remove();
                    }).catch((error) => {
                        console.error('Error menandai notifikasi Ulan:', error);
                    });
                }
                
                // Navigate to the relevant form section
                showSection(`form-${formType}`);
                
                // Show requests tab
                setTimeout(() => {
                    showFormTab(formType, 'requests');
                    
                    // Scroll to and highlight the specific request if possible
                    setTimeout(() => {
                        const requestElement = document.querySelector(`[data-request-id="${requestId}"]`);
                        if (requestElement) {
                            requestElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
                            requestElement.classList.add('request-highlight');
                            
                            setTimeout(() => {
                                requestElement.classList.remove('request-highlight');
                            }, 3000);
                        }
                    }, 500);
                }, 300);
                
                // Close notification dropdown
                notificationDropdown.classList.remove('active');
                
                // Update notification count
                const currentUser = auth.currentUser;
                if (currentUser && currentUser.email) {
                    loadAllUserNotifications(currentUser.email);
                }
            }

            // Function untuk update notification count
            function updateNotificationCount(notifications) {
                const notificationCount = document.getElementById('notification-count');
                if (!notificationCount) return;
                
                let unreadCount = 0;
                
                if (notifications && notifications.length > 0) {
                    unreadCount = notifications.filter(n => !n.read).length;
                } else {
                    // Count dari DOM
                    const unreadItems = document.querySelectorAll('.notification-item.unread');
                    unreadCount = unreadItems.length;
                }
                
                if (unreadCount > 0) {
                    notificationCount.textContent = unreadCount > 99 ? '99+' : unreadCount;
                    notificationCount.style.display = 'flex';
                    
                    // Update badge color based on count
                    if (unreadCount > 5) {
                        notificationCount.className = 'notification-count high';
                    } else if (unreadCount > 2) {
                        notificationCount.className = 'notification-count medium';
                    } else {
                        notificationCount.className = 'notification-count';
                    }
                } else {
                    notificationCount.style.display = 'none';
                }
            }

            // Helper functions
            function isNotificationRelevant(request, userName, userEmail) {
                const userPermission = userPermissions[userEmail];
                const status = request.status || 'pending';
                
                // Skip if status is not one we track
                if (!['pending', 'approved', 'rejected'].includes(status)) {
                    return false;
                }
                
                // For approvers: show notifications for requests they can approve
                if (userPermission && userPermission.allowedForms.includes(request.formType)) {
                    if (request.formType === 'atk') {
                        // Cek berdasarkan nama pemohon dan nilai request
                        const approvers = getApprovedByForRequest(request.nama, request.nilai);
                        if (approvers.includes(userName)) {
                            return true;
                        }
                    }
                    if (request.formType === 'laptop') {
                        // Cek berdasarkan nama pemohon untuk request IT
                        const approvers = getApprovedByForITRequest(request.nama);
                        if (approvers.includes(userName)) {
                            return true;
                        }
                    }
                    if (['kartunama', 'idcard', 'konsumsi'].includes(request.formType) && 
                        ['Ulan', 'Caecilia Renata'].includes(userName)) {
                        return true;
                    }
                    if (request.formType === 'feedback' && userName === 'Caecilia Renata') {
                        return true;
                    }
                }
                
                // For requesters: show notifications for their own requests
                if (request.nama && (request.nama.includes(userName) || request.nama === userName)) {
                    return true;
                }
                
                return false;
            }

            function getNotificationContent(notification) {
                // Untuk notifikasi Ulan khusus
                if (notification.isUlanNotification) {
                    let iconClass = 'pending';
                    let message = notification.originalMessage;
                    let isImportant = true;
                    
                    if (notification.notificationType === 'new_request') {
                        iconClass = 'pending important';
                    } else if (notification.notificationType === 'approval_notification') {
                        iconClass = 'approved important';
                    }
                    
                    return { iconClass, message, isImportant };
                }
                
                // Untuk notifikasi regular
                const { formType, request } = notification;
                const status = request.status || 'pending';
                const formTitle = getFormTitle(formType);
                
                let iconClass = '';
                let message = '';
                let isImportant = false;
                
                if (status === 'approved') {
                    iconClass = 'approved';
                    message = `<strong>Request ${formTitle} Disetujui</strong><br>${request.judul || request.nama}`;
                    isImportant = true;
                } else if (status === 'rejected') {
                    iconClass = 'rejected';
                    message = `<strong>Request ${formTitle} Ditolak</strong><br>${request.judul || request.nama}`;
                    isImportant = true;
                } else {
                    iconClass = 'pending';
                    if (formType === 'atk') {
                        const approvers = getApprovedByForRequest(request.nama, request.nilai);
                        const approverNames = approvers.join(' & ');
                        message = `<strong>Request ATK Menunggu Persetujuan ${approverNames}</strong><br>Dari: ${request.nama} (${request.department})`;
                        isImportant = true;
                    } else if (formType === 'laptop') {
                        const approvers = getApprovedByForITRequest(request.nama);
                        const approvedCount = request.approvedBy ? request.approvedBy.length : 0;
                        const totalApprovers = approvers.length;
                        message = `<strong>Request IT Menunggu (${approvedCount}/${totalApprovers})</strong><br>Dari: ${request.nama}`;
                        isImportant = (approvedCount >= 3);
                    } else if (formType === 'kartunama' || formType === 'idcard' || formType === 'konsumsi') {
                        message = `<strong>Request ${formTitle} Menunggu Persetujuan</strong><br>Dari: ${request.nama}`;
                        isImportant = true;
                    } else if (formType === 'feedback') {
                        message = `<strong>Feedback Baru Diterima</strong><br>Dari: ${request.nama}`;
                        isImportant = true;
                    } else {
                        message = `<strong>Request ${formTitle} Menunggu Persetujuan</strong><br>Dari: ${request.nama}`;
                    }
                }
                
                return { iconClass, message, isImportant };
            }

            function groupNotificationsByTime(notifications) {
                const now = new Date();
                const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
                const yesterday = new Date(today);
                yesterday.setDate(yesterday.getDate() - 1);
                
                const groups = {
                    today: [],
                    yesterday: [],
                    thisWeek: [],
                    older: []
                };
                
                notifications.forEach(notification => {
                    const notifDate = new Date(notification.timestamp);
                    
                    if (notifDate >= today) {
                        groups.today.push(notification);
                    } else if (notifDate >= yesterday) {
                        groups.yesterday.push(notification);
                    } else if (notifDate >= new Date(today.getTime() - 7 * 24 * 60 * 60 * 1000)) {
                        groups.thisWeek.push(notification);
                    } else {
                        groups.older.push(notification);
                    }
                });
                
                return groups;
            }

            function isNewNotification(notificationId, request) {
                const lastCheck = lastNotificationCheck[auth.currentUser?.email];
                if (!lastCheck) return true;
                
                const requestTime = request.updatedAt ? request.updatedAt.toDate() : 
                                request.createdAt ? request.createdAt.toDate() : new Date();
                
                return requestTime > lastCheck;
            }

            // Local storage functions for notification read status
            function getNotificationReadStatus(notificationId) {
                const userEmail = auth.currentUser?.email;
                if (!userEmail) return false;
                
                const userNotifications = JSON.parse(localStorage.getItem(`notifications_${userEmail}`) || '{}');
                return !!userNotifications[notificationId]?.read;
            }

            function markNotificationAsRead(notificationId) {
                const userEmail = auth.currentUser?.email;
                if (!userEmail) return;
                
                const userNotifications = JSON.parse(localStorage.getItem(`notifications_${userEmail}`) || '{}');
                userNotifications[notificationId] = {
                    read: true,
                    readAt: new Date().toISOString()
                };
                localStorage.setItem(`notifications_${userEmail}`, JSON.stringify(userNotifications));
            }

            function markAllNotificationsAsRead() {
                const userEmail = auth.currentUser?.email;
                if (!userEmail) return;
                
                const notificationItems = document.querySelectorAll('.notification-item');
                const userNotifications = JSON.parse(localStorage.getItem(`notifications_${userEmail}`) || '{}');
                
                notificationItems.forEach(item => {
                    const notificationId = item.dataset.notificationId;
                    userNotifications[notificationId] = {
                        read: true,
                        readAt: new Date().toISOString()
                    };
                    item.classList.remove('unread');
                    item.classList.add('read');
                    item.querySelector('.unread-indicator')?.remove();
                    item.querySelector('.new-badge')?.remove();
                });
                
                localStorage.setItem(`notifications_${userEmail}`, JSON.stringify(userNotifications));
                updateNotificationCount();
                showAlert('Semua notifikasi telah ditandai sebagai sudah dibaca', 'success');
            }

            function getTimeAgo(timestamp) {
                const now = new Date();
                const diffMs = now - timestamp;
                const diffMins = Math.floor(diffMs / 60000);
                const diffHours = Math.floor(diffMins / 60);
                const diffDays = Math.floor(diffHours / 24);
                
                if (diffMins < 1) return 'Baru saja';
                if (diffMins < 60) return `${diffMins} menit lalu`;
                if (diffHours < 24) return `${diffHours} jam lalu`;
                if (diffDays < 7) return `${diffDays} hari lalu`;
                
                return timestamp.toLocaleDateString('id-ID');
            }

            // ========== OPTIMIZED REAL-TIME LISTENERS ==========

            // Function untuk inisialisasi realtime listeners yang lebih efisien
            function initializeOptimizedRealtimeListeners() {
                console.log('Initializing optimized realtime listeners');
                
                // Real-time listener untuk semua form types di approved-by tab
                const formTypes = ['atk', 'laptop'];
                
                formTypes.forEach(formType => {
                    const unsubscribe = db.collection(`requests_${formType}`)
                        .where('status', 'in', ['pending', 'approved'])
                        .orderBy('createdAt', 'desc')
                        .onSnapshot((snapshot) => {
                            console.log(`Realtime update for ${formType} approved-by tab`);
                            
                            const activeFormSection = document.querySelector('.form-section.active');
                            if (activeFormSection && activeFormSection.id === `form-${formType}`) {
                                const activeTab = activeFormSection.querySelector('.form-tab.active');
                                if (activeTab && activeTab.dataset.tab === 'approved-by') {
                                    loadApprovedByRequests(formType);
                                }
                            }
                            
                            // Juga refresh requests list jika aktif
                            if (activeFormSection && activeFormSection.id === `form-${formType}`) {
                                const activeTab = activeFormSection.querySelector('.form-tab.active');
                                if (activeTab && activeTab.dataset.tab === 'requests') {
                                    loadRequests(formType);
                                }
                            }
                        }, (error) => {
                            console.error(`Error in approved-by listener for ${formType}:`, error);
                        });
                    
                    notificationUnsubscribeFunctions.push(unsubscribe);
                });
            }

            // ========== SISTEM NOTIFIKASI UNTUK ULAN - VERSI DISEMPURNAKAN ==========

            // Fungsi untuk mengirim notifikasi ke Ulan ketika ada request GA baru
            function sendNewRequestNotificationToUlan(formType, requestId, requestData) {
                console.log(`Mengirim notifikasi ke Ulan untuk request ${formType} dengan ID: ${requestId}`);
                
                if (formType === 'atk') {
                    const notificationData = {
                        userId: 'ulandari@genetek.co.id',
                        title: 'Request GA Baru',
                        message: `Request GA baru dari ${requestData.nama} (${requestData.department}) - ${requestData.jenis} - Nilai: ${requestData.nilai}`,
                        formType: formType,
                        requestId: requestId,
                        isRead: false,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                        type: 'new_request',
                        priority: 'high'
                    };
                    
                    // Simpan notifikasi untuk Ulan di Firestore
                    db.collection('user_notifications').add(notificationData)
                    .then(() => {
                        console.log('Notifikasi request baru BERHASIL dikirim ke Ulan');
                    })
                    .catch((error) => {
                        console.error('Error mengirim notifikasi ke Ulan:', error);
                    });
                }
            }

            // Fungsi untuk mengirim notifikasi ke Ulan ketika request GA disetujui
            function sendApprovalNotificationToUlan(formType, requestId, requestData) {
                console.log(`Mengirim notifikasi persetujuan ke Ulan untuk request ${formType} dengan ID: ${requestId}`);
                
                if (formType === 'atk' && requestData.status === 'approved') {
                    const notificationData = {
                        userId: 'ulandari@genetek.co.id',
                        title: 'Request GA Disetujui',
                        message: `Request GA dari ${requestData.nama} (${requestData.department}) telah disetujui dan siap untuk diproses lebih lanjut.`,
                        formType: formType,
                        requestId: requestId,
                        isRead: false,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                        type: 'approval_notification',
                        priority: 'high'
                    };
                    
                    // Simpan notifikasi untuk Ulan di Firestore
                    db.collection('user_notifications').add(notificationData)
                    .then(() => {
                        console.log('Notifikasi persetujuan BERHASIL dikirim ke Ulan');
                    })
                    .catch((error) => {
                        console.error('Error mengirim notifikasi persetujuan ke Ulan:', error);
                    });
                }
            }

            // ========== NOTIFIKASI UNTUK SEMUA MENU ==========

            // Fungsi untuk mengirim notifikasi universal untuk semua menu
            function sendUniversalNotification(formType, requestId, requestData) {
                console.log(`Mengirim notifikasi universal untuk ${formType} dengan ID: ${requestId}`);
                
                const formTitles = {
                    'atk': 'Request GA',
                    'idcard': 'Request ID Card',
                    'konsumsi': 'Request Konsumsi',
                    'laptop': 'Request IT',
                    'kartunama': 'Request Kartu Nama',
                    'feedback': 'Feedback'
                };
                
                const formTitle = formTitles[formType] || 'Request';
                
                // Kirim notifikasi ke semua approver yang relevan
                Object.keys(userPermissions).forEach(userEmail => {
                    const userPermission = userPermissions[userEmail];
                    
                    if (userPermission.allowedForms.includes(formType)) {
                        const notificationData = {
                            userId: userEmail,
                            title: `${formTitle} Baru`,
                            message: `${formTitle} baru dari ${requestData.nama} (${requestData.department || ''})`,
                            formType: formType,
                            requestId: requestId,
                            isRead: false,
                            createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                            type: 'new_request',
                            priority: 'medium'
                        };
                        
                        // Simpan notifikasi di Firestore
                        db.collection('user_notifications').add(notificationData)
                        .then(() => {
                            console.log(`Notifikasi BERHASIL dikirim ke ${userEmail}`);
                        })
                        .catch((error) => {
                            console.error(`Error mengirim notifikasi ke ${userEmail}:`, error);
                        });
                    }
                });
            }

            // ========== MAIN APPLICATION CODE ==========

            // Navigation handling
            const cards = document.querySelectorAll('.card');
            const sections = document.querySelectorAll('section');
            const backButtons = document.querySelectorAll('.back-button');
            
            // Form elements
            const forms = {
                atk: document.getElementById('atkForm'),
                idcard: document.getElementById('idcardForm'),
                konsumsi: document.getElementById('konsumsiForm'),
                laptop: document.getElementById('laptopForm'),
                kartunama: document.getElementById('kartunamaForm'),
                feedback: document.getElementById('feedbackForm')
            };
            
            // Confirmation messages
            const confirmations = {
                atk: document.getElementById('atk-confirmation'),
                idcard: document.getElementById('idcard-confirmation'),
                konsumsi: document.getElementById('konsumsi-confirmation'),
                laptop: document.getElementById('laptop-confirmation'),
                kartunama: document.getElementById('kartunama-confirmation'),
                feedback: document.getElementById('feedback-confirmation')
            };
            
            // Requests lists
            const requestsLists = {
                atk: document.getElementById('atk-requests'),
                idcard: document.getElementById('idcard-requests'),
                konsumsi: document.getElementById('konsumsi-requests'),
                laptop: document.getElementById('laptop-requests'),
                kartunama: document.getElementById('kartunama-requests'),
                feedback: document.getElementById('feedback-requests'),
                'laptop-approved-by': document.getElementById('laptop-approved-by'),
                'atk-approved-by': document.getElementById('atk-approved-by')
            };

            // Get all form tabs
            const allFormTabs = document.querySelectorAll('.form-section .form-tab');

            // Login elements
            const loginPage = document.getElementById('login-page');
            const loginForm = document.getElementById('login-form');
            const loginEmail = document.getElementById('login-email');
            const loginPassword = document.getElementById('login-password');
            const guestLoginBtn = document.getElementById('guest-login-btn');
            const loginError = document.getElementById('login-error');
            const logoutBtn = document.getElementById('logout-btn');
            const userInfo = document.getElementById('user-info');
            const userName = document.getElementById('user-name');
            const userAvatar = document.getElementById('user-avatar');
            
            // Notification elements
            const notificationBell = document.getElementById('notification-bell');
            const notificationCount = document.getElementById('notification-count');
            const notificationDropdown = document.getElementById('notification-dropdown');
            const notificationList = document.getElementById('notification-list');
            const markAllReadBtn = document.getElementById('mark-all-read');
            const notificationSettings = document.getElementById('notification-settings');
            const enableNotificationsBtn = document.getElementById('enable-notifications');
            const notificationStatus = document.getElementById('notification-status');

            // Function to show/hide login page and main content
            function toggleLoginState(isLoggedIn, user = null) {
                if (isLoggedIn && user) {
                    // Hide login page, show main content
                    loginPage.style.display = 'none';
                    document.querySelector('header').style.display = 'block';
                    document.querySelector('main').style.display = 'block';
                    document.querySelector('footer').style.display = 'block';
                    
                    logoutBtn.style.display = 'inline-flex';
                    
                    // Tampilkan info user
                    if (user.email) {
                        const displayName = emailToNameMap[user.email] || user.email.split('@')[0];
                        userName.textContent = displayName;
                        userAvatar.textContent = displayName.charAt(0).toUpperCase();
                        userInfo.style.display = 'flex';
                        
                        // Update form tabs visibility based on permissions
                        updateFormTabsVisibility(user.email);
                        
                        // Initialize realtime notifications
                        console.log('Initializing notifications for:', user.email);
                        initializeRealtimeNotifications(user.email);
                        initializeOptimizedRealtimeListeners();
                        requestNotificationPermission();
                        
                        // Load notifikasi saat pertama login
                        setTimeout(() => {
                            loadAllUserNotifications(user.email);
                        }, 1000);
                        
                        // Show notification settings for logged in users
                        if (notificationSettings) {
                            notificationSettings.style.display = 'block';
                        }
                    } else {
                        // Guest user - hide request tabs
                        userName.textContent = 'Tamu';
                        userAvatar.textContent = 'T';
                        userInfo.style.display = 'flex';
                        
                        // Hide request tabs for guest users
                        document.querySelectorAll('[id$="-requests-tab"], [id$="-approved-tab"]').forEach(tab => {
                            tab.style.display = 'none';
                        });
                        
                        // Hide notifications for guest
                        notificationBell.style.display = 'none';
                        if (notificationSettings) {
                            notificationSettings.style.display = 'none';
                        }
                    }
                    
                    showSection('dashboard');
                } else {
                    // Show login page, hide main content
                    loginPage.style.display = 'flex';
                    document.querySelector('header').style.display = 'none';
                    document.querySelector('main').style.display = 'none';
                    document.querySelector('footer').style.display = 'none';
                    
                    logoutBtn.style.display = 'none';
                    userInfo.style.display = 'none';
                    
                    // Reset login form
                    if (loginForm) loginForm.reset();
                    if (loginError) loginError.style.display = 'none';
                    
                    // Clean up realtime listeners
                    notificationUnsubscribeFunctions.forEach(unsubscribe => unsubscribe());
                    notificationUnsubscribeFunctions = [];
                }
            }

            // Update form tabs visibility based on user permissions
            function updateFormTabsVisibility(userEmail) {
                if (!userEmail || !userPermissions[userEmail]) return;
                
                const userPermission = userPermissions[userEmail];
                const allFormTypes = ['atk', 'idcard', 'konsumsi', 'laptop', 'feedback', 'kartunama'];
                
                allFormTypes.forEach(formType => {
                    const requestTab = document.getElementById(`${formType}-requests-tab`);
                    const approvedTab = document.getElementById(`${formType}-approved-tab`);
                    
                    if (requestTab) {
                        requestTab.style.display = userPermission.allowedForms.includes(formType) ? 'block' : 'none';
                    }
                    
                    if (approvedTab) {
                        approvedTab.style.display = userPermission.allowedForms.includes(formType) ? 'block' : 'none';
                    }
                });
            }

            // Check authentication state
            auth.onAuthStateChanged(user => {
                console.log("Auth state changed:", user);
                if (user) {
                    console.log("User logged in:", user.email || "Guest");
                    toggleLoginState(true, user);
                    
                    // Initialize autocomplete setelah konten dimuat
                    setTimeout(() => {
                        if (typeof initializeAllAutocompletes === 'function') {
                            initializeAllAutocompletes();
                        }
                    }, 1000);
                } else {
                    console.log("User logged out");
                    toggleLoginState(false);
                }
            });

            // Handle email/password login
            if (loginForm) {
                loginForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    const email = loginEmail.value;
                    const password = loginPassword.value;

                    const allowedLoginEmails = [
                        "crenata@genetek.co.id",
                        "rossiana.yl@genetek.co.id",
                        "galih@genetek.co.id",
                        "maida@genetek.co.id",
                        "anggita-s@genetek.co.id",
                        "wahyu_yib@genetek.co.id",
                        "david@genetek.co.id",
                        "m_husni@genetek.co.id",
                        "ulandari@genetek.co.id",
                        "edwin@genetek.co.id",
                        "heksi@genetek.co.id",
                        "fikihernawan@genetek.co.id"
                    ];

                    if (!allowedLoginEmails.includes(email)) {
                        loginError.textContent = "Email tidak terdaftar sebagai approver yang diizinkan.";
                        loginError.style.display = 'block';
                        return;
                    }

                    // Show loading
                    const submitBtn = loginForm.querySelector('button[type="submit"]');
                    const originalText = submitBtn.innerHTML;
                    submitBtn.innerHTML = '<div class="loading"></div> Login...';
                    submitBtn.disabled = true;

                    auth.signInWithEmailAndPassword(email, password)
                        .then((userCredential) => {
                            const user = userCredential.user;
                            console.log("Login successful:", user.email);
                            loginError.style.display = 'none';
                            submitBtn.innerHTML = originalText;
                            submitBtn.disabled = false;
                        })
                        .catch((error) => {
                            const errorCode = error.code;
                            const errorMessage = error.message;
                            console.error("Login failed:", errorCode, errorMessage);
                            loginError.textContent = "Login gagal: " + errorMessage;
                            loginError.style.display = 'block';
                            submitBtn.innerHTML = originalText;
                            submitBtn.disabled = false;
                        });
                });
            }

            // Handle guest login
            if (guestLoginBtn) {
                guestLoginBtn.addEventListener('click', function() {
                    // Show loading
                    const originalText = guestLoginBtn.innerHTML;
                    guestLoginBtn.innerHTML = '<div class="loading"></div> Login...';
                    guestLoginBtn.disabled = true;

                    auth.signInAnonymously()
                        .then((userCredential) => {
                            console.log("Signed in as guest:", userCredential.user.uid);
                            loginError.style.display = 'none';
                            guestLoginBtn.innerHTML = originalText;
                            guestLoginBtn.disabled = false;
                            
                            // Show success message
                            showAlert('Login sebagai tamu berhasil!', 'success');
                        })
                        .catch((error) => {
                            const errorCode = error.code;
                            const errorMessage = error.message;
                            console.error("Guest login failed:", errorCode, errorMessage);
                            
                            // User-friendly error messages
                            let userFriendlyError = "Gagal masuk sebagai tamu. Silakan coba lagi.";
                            if (errorCode === 'auth/admin-restricted-operation') {
                                userFriendlyError = "Login tamu dinonaktifkan. Silakan hubungi administrator.";
                            } else if (errorCode === 'auth/network-request-failed') {
                                userFriendlyError = "Koneksi internet bermasalah. Periksa koneksi Anda.";
                            }
                            
                            loginError.textContent = userFriendlyError;
                            loginError.style.display = 'block';
                            guestLoginBtn.innerHTML = originalText;
                            guestLoginBtn.disabled = false;
                        });
                });
            }

            // Handle logout
            if (logoutBtn) {
                logoutBtn.addEventListener('click', function() {
                    // Show loading
                    const originalText = logoutBtn.innerHTML;
                    logoutBtn.innerHTML = '<div class="loading"></div> Logout...';
                    logoutBtn.disabled = true;

                    auth.signOut().then(() => {
                        console.log("User signed out");
                        logoutBtn.innerHTML = originalText;
                        logoutBtn.disabled = false;
                    }).catch((error) => {
                        console.error("Logout failed:", error);
                        showAlert('Logout gagal', 'danger');
                        logoutBtn.innerHTML = originalText;
                        logoutBtn.disabled = false;
                    });
                });
            }
            
            // Notification bell click event
            if (notificationBell) {
                notificationBell.addEventListener('click', function(e) {
                    e.stopPropagation();
                    notificationDropdown.classList.toggle('active');
                    
                    // Refresh notifications when dropdown is opened
                    if (notificationDropdown.classList.contains('active')) {
                        const currentUser = auth.currentUser;
                        if (currentUser && currentUser.email) {
                            loadAllUserNotifications(currentUser.email);
                        }
                    }
                });
            }
            
            // Mark all notifications as read
            if (markAllReadBtn) {
                markAllReadBtn.addEventListener('click', function() {
                    markAllNotificationsAsRead();
                });
            }
            
            // Enable notifications button
            if (enableNotificationsBtn) {
                enableNotificationsBtn.addEventListener('click', function() {
                    requestNotificationPermission();
                });
            }
            
            // Close notification dropdown when clicking outside
            document.addEventListener('click', function() {
                if (notificationDropdown.classList.contains('active')) {
                    notificationDropdown.classList.remove('active');
                }
            });
            
            // Prevent dropdown from closing when clicking inside
            if (notificationDropdown) {
                notificationDropdown.addEventListener('click', function(e) {
                    e.stopPropagation();
                });
            }
            
            // Logo button event listener
            const logoHomeButton = document.getElementById('logo-home-button');
            if (logoHomeButton) {
                logoHomeButton.addEventListener('click', function() {
                    showSection('dashboard');
                });
            }
            
            // Show section based on target
            function showSection(targetId) {
                sections.forEach(section => {
                    section.classList.remove('active');
                });
                
                const targetSection = document.getElementById(targetId);
                if (targetSection) {
                    targetSection.classList.add('active');
                }
                
                // Show form tab by default when navigating to a form
                if (targetId !== 'dashboard') {
                    showFormTab(targetId.replace('form-', ''), 'form');
                }
            }
            
            // Show the appropriate tab (form or requests)
            function showFormTab(formType, tabType) {
                const currentFormSection = document.getElementById(`form-${formType}`);
                if (!currentFormSection) return;

                const formElement = currentFormSection.querySelector('form');
                const confirmationElement = confirmations[formType];
                const requestsElement = requestsLists[formType];
                const approvedByElement = document.getElementById(`${formType}-approved-by`);
                
                // Update active tab
                currentFormSection.querySelectorAll('.form-tab').forEach(tab => {
                    tab.classList.remove('active');
                    if (tab.dataset.tab === tabType) {
                        tab.classList.add('active');
                    }
                });
                
                // Sembunyikan semua konten tab terlebih dahulu
                if (formElement) formElement.style.display = 'none';
                if (confirmationElement) confirmationElement.style.display = 'none';
                if (requestsElement) requestsElement.style.display = 'none';
                if (approvedByElement) approvedByElement.style.display = 'none';

                // Cek jika user adalah tamu, jangan tampilkan daftar request
                const currentUser = auth.currentUser;
                const isGuest = !currentUser || currentUser.isAnonymous;
                const userEmail = currentUser ? currentUser.email : null;
                
                // Check permissions for request tabs
                if ((tabType === 'requests' || tabType === 'approved-by') && userEmail) {
                    const userPermission = userPermissions[userEmail];
                    if (!userPermission || !userPermission.allowedForms.includes(formType)) {
                        showAlert('Anda tidak memiliki akses untuk melihat daftar request ini', 'warning');
                        if (formElement) formElement.style.display = 'block';
                        return;
                    }
                }
                
                if (tabType === 'form') {
                    if (formElement) formElement.style.display = 'block';
                } else if (tabType === 'requests') {
                    if (requestsElement && !isGuest) {
                        requestsElement.style.display = 'block';
                        loadRequests(formType);
                    } else if (isGuest) {
                        // Untuk tamu, tetap tampilkan form
                        if (formElement) formElement.style.display = 'block';
                        showAlert('Fitur ini tidak tersedia untuk tamu', 'warning');
                    }
                } else if (tabType === 'approved-by' && (formType === 'laptop' || formType === 'atk')) {
                    if (approvedByElement && !isGuest) {
                        approvedByElement.style.display = 'block';
                        loadApprovedByRequests(formType);
                    } else if (isGuest) {
                        // Untuk tamu, tetap tampilkan form
                        if (formElement) formElement.style.display = 'block';
                        showAlert('Fitur ini tidak tersedia untuk tamu', 'warning');
                    }
                }
            }
            
            // Load requests for a specific form type from Firestore - FILTERED BY APPROVER
            function loadRequests(formType) {
                const requestsListContainer = document.getElementById(`${formType}-requests-list`);
                if (!requestsListContainer) return;

                // Show loading state
                requestsListContainer.innerHTML = `
                    <div class="empty-state">
                        <div class="loading"></div>
                        <p>Memuat data request...</p>
                    </div>
                `;

                // Gunakan collection name yang benar
                const collectionName = `requests_${formType}`;
                console.log(`Loading requests from collection: ${collectionName}`);

                // Dapatkan informasi user yang sedang login
                const currentUser = auth.currentUser;
                const userEmail = currentUser ? currentUser.email : null;
                const userName = userEmail ? emailToNameMap[userEmail] : null;
                const isGuest = !userEmail || currentUser.isAnonymous;

                // Jika user adalah guest, tidak perlu memuat request
                if (isGuest) {
                    requestsListContainer.innerHTML = `
                        <div class="empty-state">
                            <i class="fas fa-user-slash"></i>
                            <p>Fitur ini tidak tersedia untuk tamu</p>
                        </div>
                    `;
                    return;
                }

                db.collection(collectionName)
                    .orderBy('createdAt', 'desc')
                    .get()
                    .then((querySnapshot) => {
                        const requests = [];
                        querySnapshot.forEach((doc) => {
                            requests.push({ id: doc.id, ...doc.data() });
                        });

                        console.log(`Loaded ${requests.length} requests for ${formType}`, requests);

                        // Filter requests berdasarkan approver yang relevan
                        const filteredRequests = requests.filter(request => {
                            // Jika user adalah Ulan atau Caecilia Renata, tampilkan semua request untuk form tertentu
                            if (['ulandari@genetek.co.id', 'crenata@genetek.co.id'].includes(userEmail)) {
                                if (['kartunama', 'idcard', 'konsumsi'].includes(formType)) {
                                    return true;
                                }
                            }
                            
                            // Untuk form ATK
                            if (formType === 'atk') {
                                const approvers = getApprovedByForRequest(request.nama, request.nilai);
                                return approvers.includes(userName);
                            }
                            
                            // Untuk form Laptop/IT
                            if (formType === 'laptop') {
                                const approvers = getApprovedByForITRequest(request.nama);
                                return approvers.includes(userName);
                            }
                            
                            // Untuk form lainnya, hanya tampilkan jika user adalah approver yang diizinkan
                            const userPermission = userPermissions[userEmail];
                            return userPermission && userPermission.allowedForms.includes(formType);
                        });

                        console.log(`Filtered to ${filteredRequests.length} requests for ${userName}`);

                        if (filteredRequests.length === 0) {
                            requestsListContainer.innerHTML = `
                                <div class="empty-state">
                                    <i class="fas fa-inbox"></i>
                                    <p>Belum ada request ${getFormTitle(formType)} yang relevan untuk Anda</p>
                                </div>
                            `;
                            return;
                        }
                        
                        requestsListContainer.innerHTML = '';
                        filteredRequests.forEach((request, index) => {
                            // LOGIKA STATUS: 
                            let status = request.status || 'pending';
                            let statusClass = 'pending';
                            let statusText = 'Menunggu';
                            
                            // Untuk ATK: jika sudah disetujui approver yang sesuai, status menjadi "Disetujui"
                            if (formType === 'atk') {
                                const approvers = getApprovedByForRequest(request.nama, request.nilai);
                                const isAllApproved = approvers.every(approver => 
                                    request.approvedBy && request.approvedBy.includes(approver)
                                );
                                
                                if (isAllApproved) {
                                    status = 'approved';
                                    statusClass = 'approved';
                                    statusText = 'Disetujui';
                                } else if (request.status === 'approved') {
                                    statusClass = 'approved';
                                    statusText = 'Disetujui';
                                } else if (request.status === 'rejected') {
                                    statusClass = 'rejected';
                                    statusText = 'Ditolak';
                                } else {
                                    statusText = `Menunggu ${approvers.join(' & ')}`;
                                }
                            } 
                            // Untuk Laptop: jika sudah semua user yang approve, status menjadi "Disetujui"
                            else if (formType === 'laptop') {
                                const approvers = getApprovedByForITRequest(request.nama);
                                const isAllApproved = approvers.every(approver => 
                                    request.approvedBy && request.approvedBy.includes(approver)
                                );
                                
                                if (isAllApproved) {
                                    status = 'approved';
                                    statusClass = 'approved';
                                    statusText = 'Disetujui';
                                } else if (request.status === 'approved') {
                                    statusClass = 'approved';
                                    statusText = 'Disetujui';
                                } else if (request.status === 'rejected') {
                                    statusClass = 'rejected';
                                    statusText = 'Ditolak';
                                } else {
                                    // Tampilkan jumlah approval yang sudah ada
                                    const approvedCount = request.approvedBy ? request.approvedBy.length : 0;
                                    const totalApprovers = approvers.length;
                                    statusText = `Menunggu (${approvedCount}/${totalApprovers})`;
                                }
                            }
                            // Untuk form lainnya termasuk kartunama, idcard, konsumsi
                            else {
                                if (request.status === 'approved') {
                                    statusClass = 'approved';
                                    statusText = 'Disetujui';
                                } else if (request.status === 'rejected') {
                                    statusClass = 'rejected';
                                    statusText = 'Ditolak';
                                } else {
                                    statusClass = 'pending';
                                    statusText = 'Menunggu';
                                }
                            }
                            
                            const requestElement = document.createElement('div');
                            requestElement.className = 'request-item';
                            requestElement.dataset.requestId = request.id;
                            
                            // Generate request details based on form type
                            let requestDetails = '';
                            
                            if (formType === 'atk') {
                                requestDetails = `
                                    <div>Oleh: ${request.nama}  ${request.department}</div>
                                    <div>Tanggal: ${request.tanggal}</div>
                                    <div>Kategori: ${request.jenis}</div>
                                    <div>Nilai: ${request.nilai || 'Tidak ditentukan'}</div>
                                    <div>Detail: ${request.detail}</div>
                                `;
                            } else if (formType === 'idcard') {
                                requestDetails = `
                                    <div>Oleh: ${request.nama}  ${request.department}</div>
                                    <div>Posisi: ${request.posisi}</div>
                                    <div>Jenis Request: ${request['jenis-request']}</div>
                                    <div>Keterangan: ${request.keterangan || '-'}</div>
                                `;
                            } else if (formType === 'konsumsi') {
                                requestDetails = `
                                    <div>Oleh: ${request.nama}  ${request.department}</div>
                                    <div>Acara: ${request.acara}</div>
                                    <div>Tanggal: ${request.tanggal}  Waktu: ${request.waktu}</div>
                                    <div>Jumlah Peserta: ${request['jumlah-peserta']}</div>
                                    <div>Jenis Konsumsi: ${Array.isArray(request.jenis) ? request.jenis.join(', ') : request.jenis}</div>
                                `;
                            } else if (formType === 'laptop') {
                                requestDetails = `
                                    <div>Oleh: ${request.nama}  ${request.department}</div>
                                    <div>Tanggal: ${request.tanggal}</div>
                                    <div>Jenis Request: ${request['jenis-request']}</div>
                                    ${request.spesifikasi ? `<div>Spesifikasi: ${request.spesifikasi}</div>` : ''}
                                `;
                            } else if (formType === 'kartunama') {
                                requestDetails = `
                                    <div>Oleh: ${request.nama}  ${request.department}</div>
                                    <div>Posisi: ${request.posisi}</div>
                                    <div>Email: ${request.email}</div>
                                    <div>Telpon: ${request.telpon}</div>
                                    <div>Jumlah: ${request.jumlah} kartu</div>
                                    ${request.keterangan ? `<div>Keterangan: ${request.keterangan}</div>` : ''}
                                `;
                            } else if (formType === 'feedback') {
                                requestDetails = `
                                    <div>Oleh: ${request.nama}  ${request.department}</div>
                                    <div>Tanggal: ${request.tanggal}</div>
                                    <div>Kategori: ${request.kategori}</div>
                                    <div>Penilaian: ${request.penilaian}/10</div>
                                `;
                            }
                            
                            // Cek apakah user memiliki akses untuk mengubah status
                            const userPermission = userPermissions[userEmail];
                            const canEditStatus = userPermission && userPermission.allowedForms.includes(formType);
                            
                            // Buat dropdown untuk form kartunama, idcard, dan konsumsi
                            let statusControl;
                            if (['kartunama', 'idcard', 'konsumsi'].includes(formType) && canEditStatus) {
                                statusControl = `
                                    <select class="status-dropdown ${statusClass}" data-request-id="${request.id}" data-form-type="${formType}">
                                        <option value="pending" ${status === 'pending' ? 'selected' : ''}>Menunggu</option>
                                        <option value="approved" ${status === 'approved' ? 'selected' : ''}>Disetujui</option>
                                        <option value="rejected" ${status === 'rejected' ? 'selected' : ''}>Ditolak</option>
                                    </select>
                                `;
                            } else {
                                // Untuk form lain atau user tanpa akses, tampilkan status biasa
                                statusControl = `<div class="request-status status-${statusClass}">${statusText}</div>`;
                            }
                            
                            requestElement.innerHTML = `
                                <div class="request-info">
                                    <div class="request-title">${request.judul || getRequestTitle(formType, request)}</div>
                                    <div class="request-details">
                                        ${requestDetails}
                                        ${request.approvedBy && request.approvedBy.length > 0 ? `<div>Disetujui oleh: ${request.approvedBy.join(', ')}</div>` : ''}
                                    </div>
                                </div>
                                ${statusControl}
                            `;
                            
                            // Add animation delay based on index
                            requestElement.style.animationDelay = `${index * 0.1}s`;
                            requestsListContainer.appendChild(requestElement);
                        });
                        
                        // Tambahkan event listener untuk dropdown status
                        requestsListContainer.querySelectorAll('.status-dropdown').forEach(dropdown => {
                            dropdown.addEventListener('change', function() {
                                const requestId = this.dataset.requestId;
                                const formType = this.dataset.formType;
                                const newStatus = this.value;
                                
                                // Update status di Firestore
                                updateRequestStatus(formType, requestId, newStatus);
                                
                                // Update class dropdown berdasarkan status baru
                                this.className = `status-dropdown ${newStatus}`;
                                
                                showAlert(`Status berhasil diubah menjadi ${getStatusText(newStatus)}`, 'success');
                            });
                        });
                    })
                    .catch((error) => {
                        console.error("Error loading requests:", error);
                        requestsListContainer.innerHTML = `
                            <div class="empty-state">
                                <i class="fas fa-exclamation-triangle"></i>
                                <p>Gagal memuat data request</p>
                                <p style="font-size: 0.8rem; margin-top: 10px;">Error: ${error.message}</p>
                            </div>
                        `;
                    });
            }

            // Helper function untuk mendapatkan teks status
            function getStatusText(status) {
                const statusTexts = {
                    'pending': 'Menunggu',
                    'approved': 'Disetujui',
                    'rejected': 'Ditolak'
                };
                return statusTexts[status] || status;
            }

            // Fungsi untuk memuat daftar request yang perlu disetujui dari Firestore
            function loadApprovedByRequests(formType) {
                const approvedByListContainer = document.getElementById(`${formType}-approved-by-list`);
                if (!approvedByListContainer) return;

                // Show loading state
                approvedByListContainer.innerHTML = `
                    <div class="empty-state">
                        <div class="loading"></div>
                        <p>Memuat data request...</p>
                    </div>
                `;

                db.collection(`requests_${formType}`)
                    .where('status', 'in', ['pending', 'approved'])
                    .orderBy('createdAt', 'desc')
                    .get()
                    .then((querySnapshot) => {
                        const pendingRequests = [];
                        querySnapshot.forEach((doc) => {
                            pendingRequests.push({ id: doc.id, ...doc.data() });
                        });

                        if (pendingRequests.length === 0) {
                            approvedByListContainer.innerHTML = `
                                <div class="empty-state">
                                    <i class="fas fa-check-double"></i>
                                    <p>Tidak ada request ${getFormTitle(formType)} yang menunggu persetujuan.</p>
                                </div>
                            `;
                            return;
                        }

                        approvedByListContainer.innerHTML = '';
                        
                        const currentUserEmail = auth.currentUser ? auth.currentUser.email : null;
                        const currentUserName = currentUserEmail ? emailToNameMap[currentUserEmail] : null;

                        pendingRequests.forEach((request, index) => {
                            // LOGIKA STATUS: Cek apakah request sudah disetujui
                            let isApproved = false;
                            let approvalText = '';
                            let approvers = [];
                            
                            if (formType === 'laptop') {
                                // Untuk request IT: atasan langsung, Galih, Maida, Caecilia Renata, Rossiana Y.L
                                approvers = getApprovedByForITRequest(request.nama);
                                const isAllApproved = approvers.every(approver => 
                                    request.approvedBy && request.approvedBy.includes(approver)
                                );
                                
                                isApproved = isAllApproved;
                                const approvedCount = request.approvedBy ? request.approvedBy.length : 0;
                                approvalText = isAllApproved ? 'Sudah disetujui semua' : `Menunggu (${approvedCount}/${approvers.length})`;
                                
                                // Update status di database jika sudah disetujui semua
                                if (isApproved && request.status !== 'approved') {
                                    db.collection(`requests_${formType}`).doc(request.id).update({
                                        status: 'approved'
                                    });
                                }
                            } else if (formType === 'atk') {
                                // Tentukan approver berdasarkan nama pemohon dan nilai request
                                approvers = getApprovedByForRequest(request.nama, request.nilai);
                                const isAllApproved = approvers.every(approver => 
                                    request.approvedBy && request.approvedBy.includes(approver)
                                );
                                
                                isApproved = isAllApproved;
                                approvalText = isAllApproved ? 'Sudah disetujui' : `Menunggu ${approvers.join(' & ')}`;
                                
                                // Update status di database jika sudah disetujui
                                if (isApproved && request.status !== 'approved') {
                                    db.collection(`requests_${formType}`).doc(request.id).update({
                                        status: 'approved'
                                    });
                                }
                            }
                            
                            const requestElement = document.createElement('div');
                            requestElement.className = 'request-item';
                            requestElement.style.flexDirection = 'column';
                            requestElement.style.alignItems = 'flex-start';
                            requestElement.style.gap = '10px';
                            
                            // Generate content berdasarkan form type
                            let requestDetails = '';
                            if (formType === 'atk') {
                                requestDetails = `
                                    <div>Oleh: ${request.nama}  ${request.department}</div>
                                    <div>Tanggal: ${request.tanggal}</div>
                                    <div>Kategori: ${request.jenis}</div>
                                    <div>Nilai: ${request.nilai || 'Tidak ditentukan'}</div>
                                    <div>Detail: ${request.detail}</div>
                                    <div>Alasan: ${request.alasan}</div>
                                    <div>Status Persetujuan: ${approvalText}</div>
                                `;
                            } else if (formType === 'laptop') {
                                requestDetails = `
                                    <div>Oleh: ${request.nama}  ${request.department}</div>
                                    <div>Tanggal: ${request.tanggal}</div>
                                    <div>Jenis Request: ${request['jenis-request']}</div>
                                    ${request.spesifikasi ? `<div>Spesifikasi: ${request.spesifikasi}</div>` : ''}
                                    ${request['merk-model'] ? `<div>Merk/Model: ${request['merk-model']}</div>` : ''}
                                    <div>Deskripsi: ${request['masalah-kebutuhan']}</div>
                                    <div>Status Persetujuan: ${approvalText}</div>
                                `;
                            }
                            
                            requestElement.innerHTML = `
                                <div class="request-info" style="width: 100%;">
                                    <div class="request-title">${request.judul || getRequestTitle(formType, request)}</div>
                                    <div class="request-details">
                                        ${requestDetails}
                                    </div>
                                </div>
                                <div class="approved-by-options" style="width: 100%; border-top: 1px solid var(--border); padding-top: 10px; margin-top: 10px;">
                                    <label style="font-weight: 600; margin-bottom: 5px;">Status Persetujuan:</label>
                                    <div class="approver-checkboxes">
                                        ${approvers.map(approver => {
                                            const isCurrentUserApprover = (currentUserName === approver);
                                            const isChecked = request.approvedBy && request.approvedBy.includes(approver);

                                            return `
                                                <div class="approver-option">
                                                    <input type="checkbox" id="approve-${request.id}-${approver}"
                                                        data-request-id="${request.id}"
                                                        data-approver="${approver}"
                                                        ${isChecked ? 'checked' : ''}
                                                        ${!isCurrentUserApprover ? 'disabled' : ''}>
                                                    <label for="approve-${request.id}-${approver}" style="margin-bottom: 0;">${approver}</label>
                                                </div>
                                            `;
                                        }).join('')}
                                    </div>
                                    <div class="action-buttons">
                                        <button class="btn btn-primary btn-sm approve-btn" data-request-id="${request.id}" ${!currentUserName ? 'disabled' : ''}>
                                            <i class="fas fa-check"></i> Setujui
                                        </button>
                                        <button class="btn btn-danger btn-sm reject-btn" data-request-id="${request.id}" ${!currentUserName ? 'disabled' : ''}>
                                            <i class="fas fa-times"></i> Tolak
                                        </button>
                                    </div>
                                </div>
                            `;

                            approvedByListContainer.appendChild(requestElement);
                        });

                        // Event listener untuk tombol Setujui
                        approvedByListContainer.querySelectorAll('.approve-btn').forEach(button => {
                            button.addEventListener('click', function() {
                                const requestId = this.dataset.requestId;
                                const currentUserEmail = auth.currentUser ? auth.currentUser.email : null;
                                const currentUserName = currentUserEmail ? emailToNameMap[currentUserEmail] : null;
                                
                                if (currentUserName) {
                                    // Setujui request dan centang checkbox user saat ini
                                    updateApprovalStatus(formType, requestId, currentUserName, true);
                                    
                                    // Cek apakah sudah ada persetujuan
                                    db.collection(`requests_${formType}`).doc(requestId).get()
                                        .then((doc) => {
                                            if (doc.exists) {
                                                const request = doc.data();
                                                
                                                if (formType === 'laptop') {
                                                    const approvers = getApprovedByForITRequest(request.nama);
                                                    const isAllApproved = approvers.every(approver => 
                                                        request.approvedBy && request.approvedBy.includes(approver)
                                                    );
                                                    
                                                    if (isAllApproved) {
                                                        db.collection(`requests_${formType}`).doc(requestId).update({
                                                            status: 'approved'
                                                        });
                                                        showAlert('Request telah disetujui oleh semua approver!', 'success');
                                                    } else {
                                                        showAlert('Anda telah menyetujui request ini!', 'success');
                                                    }
                                                } else if (formType === 'atk') {
                                                    const approvers = getApprovedByForRequest(request.nama, request.nilai);
                                                    const isAllApproved = approvers.every(approver => 
                                                        request.approvedBy && request.approvedBy.includes(approver)
                                                    );
                                                    
                                                    if (isAllApproved) {
                                                        db.collection(`requests_${formType}`).doc(requestId).update({
                                                            status: 'approved'
                                                        });
                                                        showAlert('Request telah disetujui oleh semua approver!', 'success');
                                                    } else {
                                                        showAlert('Anda telah menyetujui request ini!', 'success');
                                                    }
                                                }
                                            }
                                        });
                                }
                            });
                        });

                        // Event listener untuk tombol Tolak
                        approvedByListContainer.querySelectorAll('.reject-btn').forEach(button => {
                            button.addEventListener('click', function() {
                                const requestId = this.dataset.requestId;
                                updateRequestStatus(formType, requestId, 'rejected');
                                showAlert('Request telah ditolak!', 'danger');
                            });
                        });
                    })
                    .catch((error) => {
                        console.error("Error loading approved by requests:", error);
                        approvedByListContainer.innerHTML = `
                            <div class="empty-state">
                                <i class="fas fa-exclamation-triangle"></i>
                                <p>Gagal memuat data request</p>
                                <p style="font-size: 0.8rem; margin-top: 10px;">Error: ${error.message}</p>
                            </div>
                        `;
                    });
            }

            // Fungsi untuk memperbarui status persetujuan di Firestore
            function updateApprovalStatus(formType, requestId, approverName, isApproved) {
                return db.collection(`requests_${formType}`).doc(requestId).get()
                    .then((doc) => {
                        if (doc.exists) {
                            const request = doc.data();
                            const approvedBy = request.approvedBy || [];
                            
                            if (isApproved) {
                                if (!approvedBy.includes(approverName)) {
                                    approvedBy.push(approverName);
                                }
                            } else {
                                const index = approvedBy.indexOf(approverName);
                                if (index > -1) {
                                    approvedBy.splice(index, 1);
                                }
                            }
                            
                            return db.collection(`requests_${formType}`).doc(requestId).update({
                                approvedBy: approvedBy
                            }).then(() => {
                                // Kirim notifikasi ke Ulan jika Caecilia Renata yang menyetujui dan formType adalah atk
                                if (isApproved && approverName === 'Caecilia Renata' && formType === 'atk') {
                                    // Ambil data request terbaru untuk notifikasi
                                    return db.collection(`requests_${formType}`).doc(requestId).get()
                                        .then((updatedDoc) => {
                                            if (updatedDoc.exists) {
                                                const updatedRequest = updatedDoc.data();
                                                sendApprovalNotificationToUlan(formType, requestId, updatedRequest);
                                            }
                                        });
                                }
                                return { approvedBy: approvedBy };
                            });
                        }
                    })
                    .then((result) => {
                        // Muat ulang daftar untuk update
                        loadApprovedByRequests(formType);
                        loadRequests(formType);
                        return result;
                    })
                    .catch((error) => {
                        console.error("Error updating approval status:", error);
                        showAlert('Gagal memperbarui status persetujuan', 'danger');
                    });
            }

            // Fungsi untuk memperbarui status request di Firestore
            function updateRequestStatus(formType, requestId, newStatus) {
                // Ambil data request terlebih dahulu
                db.collection(`requests_${formType}`).doc(requestId).get()
                    .then((doc) => {
                        if (doc.exists) {
                            const requestData = doc.data();
                            
                            // Update status
                            return db.collection(`requests_${formType}`).doc(requestId).update({
                                status: newStatus,
                                updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                            }).then(() => {
                                // Jika status diubah menjadi approved dan formType adalah atk, kirim notifikasi ke Ulan
                                if (newStatus === 'approved' && formType === 'atk') {
                                    sendApprovalNotificationToUlan(formType, requestId, { ...requestData, status: newStatus });
                                }
                                return { success: true };
                            });
                        }
                    })
                    .then((result) => {
                        if (result && result.success) {
                            console.log(`Status updated to ${newStatus} for request ${requestId}`);
                        }
                    })
                    .catch((error) => {
                        console.error("Error updating request status:", error);
                        showAlert('Gagal memperbarui status request', 'danger');
                    });
            }

            // Fungsi untuk menampilkan alert custom
            function showAlert(message, type = 'success') {
                const alert = document.createElement('div');
                alert.className = `custom-alert alert-${type}`;
                alert.innerHTML = `
                    <i class="fas ${type === 'success' ? 'fa-check-circle' : type === 'danger' ? 'fa-times-circle' : 'fa-exclamation-circle'}"></i>
                    ${message}
                `;
                
                document.body.appendChild(alert);
                
                // Hapus alert setelah 3 detik
                setTimeout(() => {
                    if (alert.parentNode) {
                        alert.remove();
                    }
                }, 3000);
            }
            
            // Helper function to get form title
            function getFormTitle(formType) {
                const titles = {
                    atk: 'ATK',
                    idcard: 'ID Card',
                    konsumsi: 'Konsumsi',
                    laptop: 'Laptop',
                    kartunama: 'Kartu Nama',
                    feedback: 'Feedback'
                };
                return titles[formType] || '';
            }
            
            // Helper function to generate request title
            function getRequestTitle(formType, request) {
                switch(formType) {
                    case 'atk': return `Permintaan ${request.jenis}`;
                    case 'idcard': return `Permintaan ID Card - ${request.nama}`;
                    case 'konsumsi': return `Konsumsi ${request.acara}`;
                    case 'laptop': return `Permintaan ${request['jenis-request']} IT`;
                    case 'kartunama': return `Permintaan Kartu Nama - ${request.nama}`;
                    case 'feedback': return `Feedback ${request.kategori} - ${request.nama}`;
                    default: return 'Permintaan';
                }
            }
            
            // Card event listeners
            cards.forEach(card => {
                card.addEventListener('click', function() {
                    showSection(this.dataset.target);
                });
            });
            
            // Back button event listeners
            backButtons.forEach(button => {
                button.addEventListener('click', function() {
                    showSection('dashboard');
                });
            });
            
            // Form tab event listeners
            allFormTabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    const formId = this.closest('.form-section').id.replace('form-', '');
                    showFormTab(formId, this.dataset.tab);
                });
            });
            
            // Form submission handlers - Save to Firestore
            Object.keys(forms).forEach(formKey => {
                if (forms[formKey]) {
                    forms[formKey].addEventListener('submit', function(e) {
                        e.preventDefault();
                        submitFormData(formKey, this);
                    });
                }
            });

            // Function to submit form data
            function submitFormData(formKey, formElement) {
                const formData = new FormData(formElement);
                const formObject = {
                    status: 'pending',
                    createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                    tanggal: new Date().toLocaleDateString('id-ID'),
                    waktu: new Date().toLocaleTimeString('id-ID'),
                    approvedBy: [] // SELALU KOSONGKAN - TIDAK ADA AUTO CHECKLIST
                };
                
                // Add form-specific data
                formData.forEach((value, key) => {
                    formObject[key] = value;
                });
                
                // MODIFIED: Handle multiple selection for konsumsi jenis
                if (formKey === 'konsumsi') {
                    // Get selected jenis konsumsi from checkboxes
                    const selectedKonsumsi = [];
                    document.querySelectorAll('input[name="jenis-konsumsi"]:checked').forEach(checkbox => {
                        if (checkbox.value === 'Lainnya') {
                            const lainnyaDetail = document.getElementById('konsumsi-lainnya-detail-input').value;
                            if (lainnyaDetail) {
                                selectedKonsumsi.push(lainnyaDetail);
                            }
                        } else {
                            selectedKonsumsi.push(checkbox.value);
                        }
                    });
                    
                    // Replace the single value with array
                    formObject.jenis = selectedKonsumsi;
                }
                
                // Add judul for the request
                formObject.judul = getRequestTitle(formKey, formObject);
                
                // Gunakan collection name yang benar
                const collectionName = `requests_${formKey}`;
                console.log(`Saving to collection: ${collectionName}`, formObject);

                // Store form data to Firestore
                db.collection(collectionName).add(formObject)
                    .then((docRef) => {
                        console.log("Document written with ID: ", docRef.id);
                        
                        // Kirim notifikasi ke Ulan untuk request GA baru
                        if (formKey === 'atk') {
                            console.log('Mengirim notifikasi untuk request ATK baru ke Ulan');
                            sendNewRequestNotificationToUlan(formKey, docRef.id, formObject);
                        }
                        
                        // Kirim notifikasi universal untuk semua menu
                        console.log('Mengirim notifikasi universal untuk semua approver');
                        sendUniversalNotification(formKey, docRef.id, formObject);
                        
                        // Hide form and show confirmation
                        formElement.style.display = 'none';
                        if (confirmations[formKey]) {
                            confirmations[formKey].classList.add('active');
                        }
                        
                        // Reset form fields
                        formElement.reset();
                        
                        // Reset checkbox styling
                        updateCheckboxOptions();
                        
                        // Hide lainnya detail
                        document.getElementById('konsumsi-lainnya-detail').style.display = 'none';
                        
                        // Auto hide confirmation after 3 seconds and show form again
                        setTimeout(() => {
                            if (confirmations[formKey]) {
                                confirmations[formKey].classList.remove('active');
                            }
                            formElement.style.display = 'block';
                        }, 3000);
                        
                        // Show success message
                        showAlert('Permintaan berhasil diajukan!', 'success');
                    })
                    .catch((error) => {
                        console.error("Error adding document: ", error);
                        showAlert('Gagal mengajukan permintaan: ' + error.message, 'danger');
                    });
            }
            
            // Set minimum date to today for date inputs
            const today = new Date().toISOString().split('T')[0];
            document.querySelectorAll('input[type="date"]').forEach(input => {
                if (input) {
                    input.min = today;
                }
            });
            
            // Refresh buttons for request lists
            document.querySelectorAll('[id^="refresh-"]').forEach(button => {
                if (button) {
                    button.addEventListener('click', function() {
                        const formType = this.id.replace('refresh-', '');
                        if (formType.includes('approved')) {
                            const baseFormType = formType.replace('-approved', '');
                            loadApprovedByRequests(baseFormType);
                        } else {
                            loadRequests(formType);
                        }
                        
                        // Add rotation animation
                        const icon = this.querySelector('i');
                        if (icon) {
                            icon.style.transition = 'transform 0.5s';
                            icon.style.transform = 'rotate(360deg)';
                            setTimeout(() => {
                                icon.style.transform = 'rotate(0deg)';
                            }, 500);
                        }
                    });
                }
            });

            // Function to request notification permission
            function requestNotificationPermission() {
                if ('Notification' in window) {
                    if (Notification.permission === 'default') {
                        Notification.requestPermission().then(permission => {
                            if (permission === 'granted') {
                                console.log('Notification permission granted');
                                showAlert('Notifikasi browser diaktifkan', 'success');
                            }
                            updateNotificationStatus();
                        });
                    }
                    updateNotificationStatus();
                }
            }

            // Function untuk update status notifikasi
            function updateNotificationStatus() {
                if (!notificationStatus) return;
                
                if ('Notification' in window) {
                    if (Notification.permission === 'granted') {
                        notificationStatus.innerHTML = '<span style="color: var(--success);"><i class="fas fa-check-circle"></i> Notifikasi browser aktif</span>';
                        if (enableNotificationsBtn) enableNotificationsBtn.style.display = 'none';
                    } else if (Notification.permission === 'denied') {
                        notificationStatus.innerHTML = '<span style="color: var(--danger);"><i class="fas fa-times-circle"></i> Notifikasi browser diblokir</span>';
                        if (enableNotificationsBtn) {
                            enableNotificationsBtn.style.display = 'block';
                            enableNotificationsBtn.innerHTML = '<i class="fas fa-unlock"></i> Buka Blokir di Pengaturan Browser';
                        }
                    } else {
                        notificationStatus.innerHTML = '<span style="color: var(--warning);"><i class="fas fa-bell-slash"></i> Notifikasi browser belum diaktifkan</span>';
                        if (enableNotificationsBtn) enableNotificationsBtn.style.display = 'block';
                    }
                } else {
                    notificationStatus.innerHTML = '<span style="color: var(--secondary);"><i class="fas fa-info-circle"></i> Browser tidak mendukung notifikasi</span>';
                    if (enableNotificationsBtn) enableNotificationsBtn.style.display = 'none';
                }
            }
            
            // MODIFIED: Update checkbox options styling
            function updateCheckboxOptions() {
                document.querySelectorAll('.checkbox-option').forEach(option => {
                    const checkbox = option.querySelector('input[type="checkbox"]');
                    if (checkbox.checked) {
                        option.classList.add('selected');
                    } else {
                        option.classList.remove('selected');
                    }
                });
            }
            
            // MODIFIED: Handle checkbox changes for konsumsi form
            document.querySelectorAll('input[name="jenis-konsumsi"]').forEach(checkbox => {
                checkbox.addEventListener('change', function() {
                    updateCheckboxOptions();
                    
                    // Show/hide lainnya detail input
                    if (this.id === 'konsumsi-lainnya' && this.checked) {
                        document.getElementById('konsumsi-lainnya-detail').style.display = 'block';
                    } else if (this.id === 'konsumsi-lainnya' && !this.checked) {
                        document.getElementById('konsumsi-lainnya-detail').style.display = 'none';
                        document.getElementById('konsumsi-lainnya-detail-input').value = '';
                    }
                });
            });
            
            // Initialize checkbox options
            updateCheckboxOptions();
        });
    </script>
</body>
</html>
